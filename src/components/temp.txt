import React from 'react';
import { Link } from 'react-router-dom';

const About = () => {
  return (
    <section id="how-it-works" className="py-20 bg-white">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 className="text-3xl md:text-4xl font-bold text-center text-gray-800 mb-12">
          How It Works
        </h2>
        
        <div className="grid md:grid-cols-3 gap-8 mb-16">
          {[
            {
              step: '1',
              title: 'Choose Your Branch',
              description: 'Select from Computer Science, Mechanical, Electrical, Civil, and more.'
            },
            {
              step: '2',
              title: 'Select Your Year',
              description: 'Get guidance specific to your current academic year (1st to 4th year)'
            },
            {
              step: '3',
              title: 'Follow The Roadmap',
              description: 'Get curated resources, skills, projects, and internship guidance'
            }
          ].map((item) => (
            <div key={item.step} className="text-center p-8 border rounded-xl hover:shadow-lg transition-shadow duration-300">
              <div className="w-16 h-16 bg-blue-600 text-white rounded-full flex items-center justify-center text-2xl font-bold mx-auto mb-6">
                {item.step}
              </div>
              <h3 className="text-xl font-semibold mb-3 text-gray-800">{item.title}</h3>
              <p className="text-gray-600">{item.description}</p>
            </div>
          ))}
        </div>

        {/* Departments Preview */}
        <div className="bg-gradient-to-r from-blue-50 to-gray-100 rounded-2xl p-8">
          <h3 className="text-2xl font-bold text-center mb-8">Available Engineering Branches</h3>
          <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
            {[
              { name: 'Computer Science', icon: 'üíª', color: 'bg-blue-100' },
              { name: 'Mechanical', icon: '‚öôÔ∏è', color: 'bg-red-100' },
              { name: 'Electrical', icon: '‚ö°', color: 'bg-yellow-100' },
              { name: 'Electronics', icon: 'üì°', color: 'bg-purple-100' },
              { name: 'Civil', icon: 'üèóÔ∏è', color: 'bg-green-100' }
            ].map((dept, index) => (
              <div key={index} className="text-center">
                <div className={`w-16 h-16 rounded-xl flex items-center justify-center text-2xl mx-auto mb-3 ${dept.color}`}>
                  {dept.icon}
                </div>
                <span className="text-gray-700 font-medium">{dept.name}</span>
              </div>
            ))}
          </div>
          
          <div className="text-center mt-8">
            <Link 
              to="/department" 
              className="inline-block bg-blue-600 text-white font-semibold px-8 py-3 rounded-lg hover:bg-blue-700 transition-colors"
            >
              View All Branches
            </Link>
          </div>
        </div>
      </div>
    </section>
  );
};

export default About;
import React, { useState, useRef, useEffect } from 'react';
import { auth, db } from '../firebase';
import { doc, getDoc } from 'firebase/firestore';
import { trackChatbotUsed } from '../utils/analytics';

export default function AdvancedChatGPT() {
  const [isOpen, setIsOpen] = useState(false);
  const [messages, setMessages] = useState([
    {
      id: 1,
      text: "Hello! I'm Claude, your AI assistant. I can help you with coding, explain complex concepts, provide career guidance, or discuss any topic you're curious about. What would you like to explore today?",
      sender: 'bot',
      timestamp: new Date()
    }
  ]);
  const [inputText, setInputText] = useState('');
  const [isTyping, setIsTyping] = useState(false);
  const [streamingMessage, setStreamingMessage] = useState('');
  const [conversationContext, setConversationContext] = useState([]);
  const [userProfile, setUserProfile] = useState({
    name: '',
    interests: [],
    skillLevel: 'beginner',
    conversationStyle: 'friendly'
  });
  const messagesEndRef = useRef(null);

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages, streamingMessage]);

  // Load user context
  useEffect(() => {
    const loadUserContext = async () => {
      const user = auth.currentUser;
      if (user) {
        try {
          const userDoc = await getDoc(doc(db, 'users', user.uid));
          if (userDoc.exists()) {
            const userData = userDoc.data();
            setUserProfile(prev => ({
              ...prev,
              name: userData.name || '',
              skillLevel: userData.year === '1st Year' ? 'beginner' : 
                         userData.year === '2nd Year' ? 'intermediate' : 'advanced'
            }));
          }
        } catch (error) {
          console.log('Context load error:', error);
        }
      }
    };
    loadUserContext();
  }, []);

  // Advanced conversation context builder
  const buildAdvancedContext = () => {
    const recentMessages = messages.slice(-10);
    const context = recentMessages.map(msg => ({
      role: msg.sender === 'user' ? 'user' : 'assistant',
      content: msg.text
    }));
    
    return context;
  };

  // Detect conversation intent and context
  const analyzeUserIntent = (message) => {
    const msg = message.toLowerCase();
    
    return {
      isQuestion: msg.includes('?') || msg.startsWith('what') || msg.startsWith('how') || msg.startsWith('why'),
      isGreeting: msg.includes('hello') || msg.includes('hi') || msg.includes('hey'),
      needsCode: msg.includes('code') || msg.includes('function') || msg.includes('syntax'),
      needsExplanation: msg.includes('explain') || msg.includes('understand') || msg.includes('learn'),
      isPersonal: msg.includes('you') || msg.includes('yourself') || msg.includes('who are'),
      emotion: msg.includes('frustrated') || msg.includes('confused') ? 'struggling' :
               msg.includes('excited') || msg.includes('love') ? 'positive' : 'neutral',
      topic: msg.includes('react') ? 'react' :
             msg.includes('javascript') ? 'javascript' :
             msg.includes('python') ? 'python' :
             msg.includes('career') ? 'career' :
             msg.includes('interview') ? 'interview' : 'general'
    };
  };

  // Advanced AI response with sophisticated prompting
  const getAdvancedAIResponse = async (userMessage) => {
    setIsTyping(true);
    setStreamingMessage('');
    const startTime = Date.now();
    
    try {
      const GEMINI_API_KEY = import.meta.env.VITE_GEMINI_API_KEY;
      
      if (!GEMINI_API_KEY || GEMINI_API_KEY === 'PASTE_YOUR_NEW_API_KEY_HERE') {
        throw new Error('API key not configured');
      }

      const context = buildAdvancedContext();
      const intent = analyzeUserIntent(userMessage);
      const userName = userProfile.name ? userProfile.name : '';
      
      // Advanced system prompt for more human-like responses
      const systemPrompt = `You are Claude, a highly intelligent and helpful AI assistant. You have a warm, engaging personality and excel at having natural conversations while providing accurate, detailed information.

CONVERSATION CONTEXT:
${context.map(msg => `${msg.role}: ${msg.content}`).join('\\n')}

USER PROFILE:
- Name: ${userName}
- Skill Level: ${userProfile.skillLevel}
- Previous topics discussed: ${conversationContext.join(', ')}

CURRENT MESSAGE ANALYSIS:
- Intent: ${intent.isQuestion ? 'Question' : intent.isGreeting ? 'Greeting' : 'Statement'}
- Topic: ${intent.topic}
- Emotion: ${intent.emotion}
- Needs code: ${intent.needsCode}

RESPONSE GUIDELINES:
1. Be conversational and natural - use "I", "you", contractions
2. Reference previous conversation when relevant
3. Match the user's energy and tone
4. Provide detailed, helpful responses
5. Ask follow-up questions to keep conversation flowing
6. Use examples and analogies when explaining concepts
7. Be encouraging and supportive
8. Show genuine interest in helping

USER MESSAGE: "${userMessage}"

Respond as Claude would - naturally, helpfully, and conversationally:`;

      const requestBody = {
        contents: [{
          parts: [{ text: systemPrompt }]
        }],
        generationConfig: {
          temperature: 0.9,
          topK: 50,
          topP: 0.95,
          maxOutputTokens: 1200,
          candidateCount: 1
        },
        safetySettings: [
          {
            category: "HARM_CATEGORY_HARASSMENT",
            threshold: "BLOCK_MEDIUM_AND_ABOVE"
          }
        ]
      };

      const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(requestBody)
      });
      
      if (!response.ok) {
        throw new Error(`API failed: ${response.status}`);
      }

      const data = await response.json();
      
      if (data.candidates?.[0]?.content?.parts?.[0]?.text) {
        const aiText = data.candidates[0].content.parts[0].text;
        
        setIsTyping(false);
        await simulateAdvancedStreaming(aiText);
        
        // Update conversation context
        setConversationContext(prev => [...prev.slice(-5), intent.topic].filter(Boolean));
        
        const responseTime = Date.now() - startTime;
        trackChatbotUsed(userMessage, responseTime);
        
        return aiText;
      } else {
        throw new Error('Invalid response structure');
      }
      
    } catch (error) {
      console.error('AI Error:', error.message);
      setIsTyping(false);
      
      const fallback = getAdvancedFallback(userMessage);
      await simulateAdvancedStreaming(fallback);
      return fallback;
    }
  };

  // Advanced streaming with realistic typing speed
  const simulateAdvancedStreaming = async (text) => {
    const sentences = text.split(/[.!?]+/).filter(s => s.trim());
    setStreamingMessage('');
    
    for (let i = 0; i < sentences.length; i++) {
      const sentence = sentences[i].trim();
      if (!sentence) continue;
      
      const words = sentence.split(' ');
      
      for (let j = 0; j < words.length; j++) {
        await new Promise(resolve => setTimeout(resolve, 40 + Math.random() * 30));
        
        const currentText = sentences.slice(0, i).join('. ') + 
                           (i > 0 ? '. ' : '') + 
                           words.slice(0, j + 1).join(' ');
        
        setStreamingMessage(currentText + (j === words.length - 1 && i < sentences.length - 1 ? '.' : ''));
      }
      
      if (i < sentences.length - 1) {
        await new Promise(resolve => setTimeout(resolve, 200));
      }
    }
    
    setStreamingMessage('');
  };

  // Advanced fallback with contextual responses
  const getAdvancedFallback = (userMessage) => {
    const msg = userMessage.toLowerCase();
    const intent = analyzeUserIntent(userMessage);
    const userName = userProfile.name ? `, ${userProfile.name}` : '';
    
    if (intent.isGreeting) {
      const greetings = [
        `Hello${userName}! It's wonderful to meet you. I'm Claude, and I'm genuinely excited to help you with whatever you're working on today. Whether it's coding challenges, learning new concepts, or just having an engaging conversation - I'm here for it all! What's sparking your curiosity right now?`,
        `Hey there${userName}! üòä I'm Claude, your AI companion for this journey. I love diving deep into interesting topics and helping people solve problems creatively. What's on your mind today? I'm ready to explore whatever interests you!`,
        `Hi${userName}! Great to see you here. I'm Claude - think of me as your intellectual sparring partner and problem-solving buddy. I'm passionate about helping people learn and grow. What challenge or question can we tackle together today?`
      ];
      return greetings[Math.floor(Math.random() * greetings.length)];
    }

    if (intent.topic === 'react') {
      return `Ah, React! ${userName} I absolutely love discussing React - it's such an elegant way to build user interfaces. The component-based architecture and the way hooks have revolutionized state management is fascinating. 

What specifically about React has caught your attention? Are you:
- Just getting started and want to understand the fundamentals?
- Working on a specific component and running into challenges?
- Curious about advanced patterns like custom hooks or context?
- Trying to optimize performance or debug something tricky?

I'm here to help you not just solve the immediate problem, but really understand the underlying concepts. What's your React journey looking like?`;
    }

    if (intent.topic === 'career') {
      return `Career development${userName} - now that's a topic I'm passionate about! Your career journey is unique, and I love helping people navigate the exciting (and sometimes overwhelming) world of tech careers.

I'm curious about where you are in your journey:
- Are you just starting out and exploring different paths?
- Looking to level up your current skills or transition to new technologies?
- Preparing for interviews or job applications?
- Thinking about long-term career strategy and growth?

I believe in taking a holistic approach - it's not just about technical skills, but also about building confidence, networking effectively, and finding work that genuinely excites you. What aspect of your career development feels most important right now?`;
    }

    if (intent.emotion === 'struggling') {
      return `I can sense some frustration in your message${userName}, and I want you to know that's completely normal and actually a sign that you're pushing yourself to grow! Every developer, from beginners to seniors, faces moments of confusion and challenge.

Here's what I've learned about working through difficult concepts:
- Breaking problems down into smaller, manageable pieces often reveals the solution
- Sometimes stepping away for a few minutes and coming back with fresh eyes works wonders
- Explaining the problem out loud (even to a rubber duck!) can help clarify your thinking

I'm here to help you work through whatever's got you stuck. Can you tell me more about what you're wrestling with? Sometimes just talking through the problem with someone who's genuinely interested in helping can make all the difference.`;
    }

    // Default advanced response
    const defaults = [
      `That's a fascinating question${userName}! I love how curious and thoughtful you are. While I'm having some connectivity issues with my main knowledge base right now, I'm still here and eager to help you think through this together. Can you tell me more about what sparked this question? I find that understanding the context often leads to the most helpful discussions.`,
      `Interesting${userName}! You've touched on something I find genuinely engaging. Even though I'm running in a limited mode right now, I'm excited to explore this topic with you. What's your current understanding of this area? I'd love to build on what you already know and help fill in any gaps.`,
      `Great question${userName}! I can tell you're someone who thinks deeply about things, which I really appreciate. While I'm experiencing some technical limitations at the moment, I'm still here to brainstorm and problem-solve with you. What's the bigger picture you're working toward? Understanding your goals helps me provide the most relevant guidance.`
    ];
    
    return defaults[Math.floor(Math.random() * defaults.length)];
  };

  const handleSendMessage = async () => {
    if (!inputText.trim()) return;

    const userMessage = {
      id: messages.length + 1,
      text: inputText,
      sender: 'user',
      timestamp: new Date()
    };

    setMessages(prev => [...prev, userMessage]);
    const currentInput = inputText;
    setInputText('');

    const aiResponse = await getAdvancedAIResponse(currentInput);
    
    const botMessage = {
      id: messages.length + 2,
      text: aiResponse,
      sender: 'bot',
      timestamp: new Date()
    };

    setMessages(prev => [...prev, botMessage]);
  };

  const handleKeyPress = (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSendMessage();
    }
  };

  const clearConversation = () => {
    setMessages([{
      id: 1,
      text: "Hello! I'm Claude, your AI assistant. I can help you with coding, explain complex concepts, provide career guidance, or discuss any topic you're curious about. What would you like to explore today?",
      sender: 'bot',
      timestamp: new Date()
    }]);
    setConversationContext([]);
  };

  const smartPrompts = [
    "I'm working on a React project and need some guidance",
    "Can you explain a complex programming concept to me?",
    "I'm feeling stuck with my coding - can you help?",
    "What's your take on the best way to learn programming?",
    "Help me think through a technical problem I'm facing",
    "I'd love to discuss career development strategies"
  ];

  return (
    <>
      {/* Chat Toggle Button */}
      <div className="fixed bottom-6 right-6 z-50">
        <button
          onClick={() => setIsOpen(!isOpen)}
          className="w-16 h-16 bg-gradient-to-r from-purple-600 via-blue-600 to-indigo-600 text-white rounded-full shadow-2xl hover:shadow-3xl hover:scale-110 transition-all duration-300 flex items-center justify-center group relative overflow-hidden"
        >
          <div className="absolute inset-0 bg-gradient-to-r from-purple-400 to-blue-400 opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
          {isOpen ? (
            <svg className="w-8 h-8 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
          ) : (
            <svg className="w-8 h-8 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 4v-4z" />
            </svg>
          )}
        </button>
        
        <div className="absolute -top-2 -right-2 w-6 h-6 bg-gradient-to-r from-green-400 to-blue-500 text-white text-xs rounded-full flex items-center justify-center animate-pulse font-bold">
          AI
        </div>
      </div>

      {/* Advanced Chat Window */}
      {isOpen && (
        <div className="fixed bottom-24 right-6 w-[450px] h-[650px] bg-white rounded-3xl shadow-2xl z-40 flex flex-col overflow-hidden border border-gray-200 backdrop-blur-sm">
          {/* Enhanced Header */}
          <div className="bg-gradient-to-r from-purple-600 via-blue-600 to-indigo-600 text-white p-5 flex items-center justify-between relative overflow-hidden">
            <div className="absolute inset-0 bg-gradient-to-r from-purple-400 to-blue-400 opacity-20"></div>
            <div className="flex items-center gap-3 relative z-10">
              <div className="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm">
                <span className="text-2xl">ü§ñ</span>
              </div>
              <div>
                <h3 className="font-bold text-lg">Claude AI</h3>
                <p className="text-xs text-purple-100">Advanced conversational AI</p>
              </div>
            </div>
            <div className="flex items-center gap-2 relative z-10">
              <button
                onClick={clearConversation}
                className="text-white/80 hover:text-white p-2 rounded-lg hover:bg-white/10 transition-colors"
                title="New conversation"
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                </svg>
              </button>
              <button
                onClick={() => setIsOpen(false)}
                className="text-white/80 hover:text-white p-1 rounded-lg hover:bg-white/10 transition-colors"
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
          </div>

          {/* Enhanced Messages Area */}
          <div className="flex-1 overflow-y-auto p-5 space-y-4 bg-gradient-to-b from-gray-50 to-white">
            {messages.map((message) => (
              <div
                key={message.id}
                className={`flex ${message.sender === 'user' ? 'justify-end' : 'justify-start'}`}
              >
                <div
                  className={`max-w-[85%] p-4 rounded-2xl ${
                    message.sender === 'user'
                      ? 'bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg'
                      : 'bg-white text-gray-800 shadow-md border border-gray-100'
                  }`}
                >
                  <p className="text-sm whitespace-pre-line leading-relaxed">{message.text}</p>
                  <p className="text-xs mt-2 opacity-70">
                    {message.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                  </p>
                </div>
              </div>
            ))}
            
            {/* Enhanced Streaming Message */}
            {streamingMessage && (
              <div className="flex justify-start">
                <div className="max-w-[85%] p-4 rounded-2xl bg-white text-gray-800 shadow-md border border-gray-100">
                  <p className="text-sm whitespace-pre-line leading-relaxed">
                    {streamingMessage}
                    <span className="inline-block w-2 h-5 bg-blue-500 ml-1 animate-pulse"></span>
                  </p>
                </div>
              </div>
            )}
            
            {/* Enhanced Typing Indicator */}
            {isTyping && !streamingMessage && (
              <div className="flex justify-start">
                <div className="bg-white p-4 rounded-2xl shadow-md border border-gray-100">
                  <div className="flex items-center space-x-2">
                    <div className="flex space-x-1">
                      <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce"></div>
                      <div className="w-2 h-2 bg-purple-500 rounded-full animate-bounce" style={{ animationDelay: '0.1s' }}></div>
                      <div className="w-2 h-2 bg-indigo-500 rounded-full animate-bounce" style={{ animationDelay: '0.2s' }}></div>
                    </div>
                    <span className="text-xs text-gray-500">Claude is thinking...</span>
                  </div>
                </div>
              </div>
            )}
            
            <div ref={messagesEndRef} />
          </div>

          {/* Smart Prompts */}
          {messages.length <= 1 && (
            <div className="p-5 border-t bg-gradient-to-r from-gray-50 to-white">
              <p className="text-xs text-gray-600 mb-3 font-semibold">Try these conversation starters:</p>
              <div className="grid grid-cols-1 gap-2">
                {smartPrompts.slice(0, 3).map((prompt, index) => (
                  <button
                    key={index}
                    onClick={() => setInputText(prompt)}
                    className="text-left text-xs bg-gradient-to-r from-blue-50 to-purple-50 p-3 rounded-xl hover:from-blue-100 hover:to-purple-100 transition-all duration-200 border border-blue-200 hover:border-purple-300 hover:shadow-md"
                  >
                    {prompt}
                  </button>
                ))}
              </div>
            </div>
          )}

          {/* Enhanced Input Area */}
          <div className="p-5 border-t bg-white">
            <div className="flex gap-3 items-end">
              <div className="flex-1 relative">
                <textarea
                  value={inputText}
                  onChange={(e) => setInputText(e.target.value)}
                  onKeyPress={handleKeyPress}
                  placeholder="Message Claude..."
                  className="w-full px-4 py-3 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm resize-none max-h-24 min-h-[48px]"
                  disabled={isTyping}
                  rows={1}
                />
              </div>
              <button
                onClick={handleSendMessage}
                disabled={!inputText.trim() || isTyping}
                className="w-12 h-12 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-2xl hover:from-blue-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl"
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                </svg>
              </button>
            </div>
          </div>
        </div>
      )}
    </>
  );
}
import React, { useState } from 'react';

export default function ApiKeyChecker() {
  const [apiKey, setApiKey] = useState('');
  const [testResult, setTestResult] = useState('');
  const [isLoading, setIsLoading] = useState(false);

  const testApiKey = async () => {
    if (!apiKey.trim()) {
      setTestResult('Please enter an API key');
      return;
    }

    setIsLoading(true);
    setTestResult('Testing...');

    try {
      const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{
            parts: [{ text: "Say hello" }]
          }]
        })
      });

      if (response.ok) {
        const data = await response.json();
        if (data.candidates?.[0]?.content?.parts?.[0]?.text) {
          setTestResult('‚úÖ API Key is working! Response: ' + data.candidates[0].content.parts[0].text);
        } else {
          setTestResult('‚ùå API Key works but response format is unexpected');
        }
      } else {
        setTestResult(`‚ùå API Key failed: ${response.status} - ${response.statusText}`);
      }
    } catch (error) {
      setTestResult(`‚ùå Error: ${error.message}`);
    }

    setIsLoading(false);
  };

  return (
    <div className="fixed top-4 left-4 bg-white p-4 rounded-lg shadow-lg border z-50 max-w-md">
      <h3 className="font-bold mb-2">API Key Tester</h3>
      <input
        type="password"
        value={apiKey}
        onChange={(e) => setApiKey(e.target.value)}
        placeholder="Paste your Gemini API key here"
        className="w-full p-2 border rounded mb-2 text-sm"
      />
      <button
        onClick={testApiKey}
        disabled={isLoading}
        className="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600 disabled:opacity-50"
      >
        {isLoading ? 'Testing...' : 'Test API Key'}
      </button>
      {testResult && (
        <div className="mt-2 p-2 bg-gray-100 rounded text-sm">
          {testResult}
        </div>
      )}
      <div className="mt-2 text-xs text-gray-600">
        Current .env key: {import.meta.env.VITE_GEMINI_API_KEY ? '‚úÖ Set' : '‚ùå Not set'}
      </div>
    </div>
  );
}
import React from 'react';
import { Link } from 'react-router-dom';

const Banner = () => {
  return (
    <div className="pt-24 pb-16 bg-gradient-to-r from-blue-50 to-gray-100">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="text-center">
          <h1 className="text-4xl md:text-6xl font-bold text-gray-800 mb-6">
            No More Confusion.
            <span className="block text-blue-600 mt-2">Your Engineering Career, Clearly Mapped.</span>
          </h1>
          
          <p className="text-xl text-gray-600 mb-10 max-w-3xl mx-auto leading-relaxed">
            Get branch-specific, year-wise guidance with curated resources from trusted sources. 
            No AI, just direct links to proven learning materials.
          </p>
          
          <div className="flex flex-col sm:flex-row gap-4 justify-center">
            <Link 
              to="/department" 
              className="inline-flex items-center justify-center px-8 py-4 text-lg font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700 transform hover:-translate-y-1 transition-all duration-300 shadow-lg hover:shadow-xl"
            >
              Start Your Journey ‚Üí
            </Link>
            
            <a 
              href="#how-it-works" 
              className="inline-flex items-center justify-center px-8 py-4 text-lg font-semibold text-blue-600 bg-white border-2 border-blue-200 rounded-lg hover:bg-blue-50 transform hover:-translate-y-1 transition-all duration-300"
            >
              Learn More
            </a>
          </div>
        </div>

        {/* Stats Section */}
        <div className="mt-20 grid grid-cols-2 md:grid-cols-4 gap-6 max-w-4xl mx-auto">
          {[
            { value: '6+', label: 'Engineering Branches' },
            { value: '100+', label: 'Trusted Resources' },
            { value: 'Year-wise', label: 'Structured Roadmap' },
            { value: '100%', label: 'Free Forever' }
          ].map((stat, index) => (
            <div key={index} className="text-center p-6 bg-white/80 backdrop-blur-sm rounded-xl shadow-sm border border-blue-100">
              <div className="text-3xl font-bold text-blue-600 mb-2">{stat.value}</div>
              <div className="text-gray-600">{stat.label}</div>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
};

export default Banner;
import React, { useState, useRef, useEffect } from 'react';
import { findBestMatch } from '../data/chatbotDataset';
import { retrieveRelevantKnowledge } from '../data/roadmapKnowledge';
import { callGeminiAPI } from '../utils/geminiAPI';

export default function ChatGPTClone() {
  const [messages, setMessages] = useState([
    {
      id: 1,
      text: "Hey there! I'm so glad you're here. üòä\n\nThink of me as your senior who's been through all the confusion, late-night coding sessions, and career anxiety you might be feeling. I'm here to help - whether you're stuck on a technical concept, worried about your future, or just need someone to talk to.\n\nWhat's on your mind today? Don't worry about asking 'silly' questions - there's no such thing. We all start somewhere!",
      sender: 'bot',
      timestamp: new Date()
    }
  ]);
  const [inputText, setInputText] = useState('');
  const [isTyping, setIsTyping] = useState(false);
  const [currentMode, setCurrentMode] = useState('CHAT');
  const [manualMode, setManualMode] = useState(null);
  const [studentProfile, setStudentProfile] = useState(null);
  const [showProfileSetup, setShowProfileSetup] = useState(false);
  const messagesEndRef = useRef(null);

  useEffect(() => {
    const profile = localStorage.getItem('studentProfile');
    if (profile) {
      setStudentProfile(JSON.parse(profile));
    } else {
      setShowProfileSetup(true);
    }
  }, []);

  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages]);

  const saveProfile = (profile) => {
    localStorage.setItem('studentProfile', JSON.stringify(profile));
    setStudentProfile(profile);
    setShowProfileSetup(false);
  };

  const detectResponseMode = (userMessage) => {
    const msg = userMessage.toLowerCase();
    const mentorKeywords = ['stress', 'anxious', 'worried', 'scared', 'confused', 'lost', 'behind', 'give up', 'quit', 'overwhelm', 'pressure', 'imposter', 'career', 'future', 'job', 'interview', 'should i', 'help me decide', 'motivation'];
    const teacherKeywords = ['what is', 'how to', 'explain', 'teach me', 'learn', 'understand', 'difference between', 'why', 'when to use', 'example', 'tutorial', 'algorithm', 'data structure', 'roadmap', 'study plan', 'prepare'];
    
    if (mentorKeywords.some(kw => msg.includes(kw))) return 'MENTOR';
    if (teacherKeywords.some(kw => msg.includes(kw))) return 'TEACHER';
    return 'CHAT';
  };

  const getModePrompt = (mode) => {
    if (mode === 'MENTOR') {
      return `You are a caring MENTOR. When student expresses stress/fear/confusion: 1) Acknowledge emotion 2) Normalize feeling 3) Give reassurance 4) Provide guidance. Be warm, empathetic, supportive. Answer ANY question they ask.`;
    } else if (mode === 'TEACHER') {
      return `You are a patient TEACHER. Break topics into simple steps, use analogies, start from basics, make learning achievable. Answer ANY question clearly.`;
    } else {
      return `You are a helpful ASSISTANT. Answer ANY question clearly and accurately. Be friendly, informative, and helpful.`;
    }
  };

  const getStudentContext = () => {
    if (!studentProfile) return '';
    return `\n\nStudent: ${studentProfile.name}, ${studentProfile.branch}, ${studentProfile.year}. Completed: ${studentProfile.completedTopics || 'Just starting'}. Focus: ${studentProfile.currentFocus || 'Exploring'}.`;
  };

  const generateMentorResponse = (userMessage, profile) => {
    const msg = userMessage.toLowerCase();
    const name = profile?.name ? `, ${profile.name}` : '';
    
    // Study plans and roadmaps
    if (msg.includes('study plan') || msg.includes('roadmap')) {
      if (msg.includes('c') && msg.includes('1 day')) {
        return `Perfect${name}! Here's your 1-day C programming crash course! üìö\n\n**Morning (9 AM - 12 PM): Basics**\n‚Ä¢ Syntax, variables, data types\n‚Ä¢ Input/output (printf, scanf)\n‚Ä¢ Operators & expressions\n‚Ä¢ Practice: 5 simple programs\n\n**Afternoon (1 PM - 4 PM): Control Flow**\n‚Ä¢ If-else, switch\n‚Ä¢ Loops (for, while, do-while)\n‚Ä¢ Break & continue\n‚Ä¢ Practice: 5 pattern programs\n\n**Evening (5 PM - 8 PM): Functions & Arrays**\n‚Ä¢ Function basics\n‚Ä¢ Arrays & strings\n‚Ä¢ Pointers introduction\n‚Ä¢ Practice: 3 mini projects\n\nüí° Tips:\n‚Ä¢ Code along, don't just read\n‚Ä¢ Use online compiler\n‚Ä¢ Focus on understanding, not memorizing\n\nReady to start? üöÄ`;
      }
      if (msg.includes('oop') && msg.includes('3 day')) {
        return `Awesome${name}! Here's your 3-day OOP mastery plan! üéØ\n\n**Day 1: Foundations**\n‚Ä¢ Classes & Objects\n‚Ä¢ Constructors & Destructors\n‚Ä¢ Access modifiers\n‚Ä¢ Practice: Create 3 classes\n\n**Day 2: Core Concepts**\n‚Ä¢ Inheritance\n‚Ä¢ Polymorphism\n‚Ä¢ Encapsulation\n‚Ä¢ Practice: Build class hierarchy\n\n**Day 3: Advanced**\n‚Ä¢ Abstraction\n‚Ä¢ Interfaces\n‚Ä¢ Real project\n‚Ä¢ Practice: Complete mini-app\n\nüí° Each day: 4-5 hours study + practice\n\nWhich language? Java, Python, C++? üöÄ`;
      }
      return `I love that you're planning ahead${name}! üòä\n\nTo create the perfect study plan, tell me:\n‚Ä¢ What topic? (DSA, OOP, Web Dev, etc.)\n‚Ä¢ How many days?\n‚Ä¢ Your current level?\n\nI'll create a customized roadmap just for you! üöÄ`;
    }
    
    if (msg.includes('dsa') || msg.includes('data structure')) {
      return `Hey${name}! Let me explain DSA in a way that makes sense. üòä\n\nDSA stands for Data Structures and Algorithms. Think of it like this:\n\nüì¶ Data Structures = Ways to organize information\n- Arrays: Like a numbered list\n- Trees: Like a family tree\n- Graphs: Like a map of connected cities\n\n‚öôÔ∏è Algorithms = Step-by-step recipes to solve problems\n- Sorting: Arranging things in order\n- Searching: Finding specific items\n\nWhy does this matter? Every app you use - Instagram, Google, Netflix - uses DSA to work fast!\n\nAre you just starting with DSA, or working on something specific? I'm here to help break it down! üöÄ`;
    }
    
    if (msg.includes('os') || msg.includes('operating system')) {
      return `Great question${name}! Let me explain Operating Systems simply. üòä\n\nThink of an OS as the manager of your computer. It's like a conductor making sure everything works together.\n\nüñ•Ô∏è What it does:\n1. Manages memory (RAM)\n2. Runs your programs\n3. Controls hardware\n4. Handles files\n5. Provides security\n\nüíª Examples: Windows, macOS, Linux, Android, iOS\n\nWhy learn this? Understanding OS helps you write better code!\n\nAre you studying this for a course? ü§î`;
    }
    
    if (msg.includes('oop') || msg.includes('object oriented')) {
      return `Ah, OOP! üòä Let me break this down${name}.\n\nOOP (Object-Oriented Programming) is writing code like real-world things.\n\nüéØ Key concepts:\n1. Classes = Blueprints\n2. Objects = Actual things\n3. Inheritance = Reusing code\n4. Encapsulation = Hiding details\n\nüí° Example: A "Student" class has properties (name, age) and actions (study, takeExam).\n\nWhy use OOP? Makes code organized and reusable!\n\nWhich language are you learning? Java, Python, C++? üöÄ`;
    }
    
    if (msg.includes('network') || msg.includes('cn')) {
      return `Computer Networks! üåê Let me explain simply${name}.\n\nIt's how computers talk to each other!\n\nüì° Key concepts:\n1. Internet = Global network\n2. Protocols = Communication rules (HTTP, TCP/IP)\n3. IP Address = Computer's address\n4. Router = Traffic controller\n\nüíª When you open Instagram:\n1. Phone sends request\n2. Router forwards it\n3. Server responds\n4. Data comes back\n\nAll in milliseconds!\n\nStudying for exams? üöÄ`;
    }
    
    return `I'm here to help you${name}! üòä\n\nI can see you're asking about "${userMessage}". Let me help you understand this better.\n\nCould you tell me:\n‚Ä¢ Are you just starting?\n‚Ä¢ Stuck on something specific?\n‚Ä¢ Preparing for exams?\n\nThe more I know, the better I can guide you! üí™\n\n(Note: AI is temporarily unavailable. Get a new API key from https://aistudio.google.com/app/apikey to enable full AI responses)`;
  };

  const getAIResponse = async (userMessage) => {
    const mode = manualMode || detectResponseMode(userMessage);
    const ragContext = retrieveRelevantKnowledge(userMessage, studentProfile);
    
    try {
      const systemPrompt = `${getModePrompt(mode)}\n\nRules: Explain simply, never judge, break into steps, give examples, be caring.${getStudentContext()}${ragContext}\n\nRespond in ${mode} MODE:`;
      const response = await callGeminiAPI(userMessage, systemPrompt);
      if (response) return response;
    } catch (error) {
      console.error('AI Error:', error);
    }
    
    return generateMentorResponse(userMessage, studentProfile);
  };

  const handleSend = async () => {
    if (!inputText.trim()) return;

    const userMessage = { id: Date.now(), text: inputText, sender: 'user', timestamp: new Date() };
    setMessages(prev => [...prev, userMessage]);
    const currentInput = inputText;
    setInputText('');
    setIsTyping(true);

    const mode = manualMode || detectResponseMode(currentInput);
    setCurrentMode(mode);
    const response = await getAIResponse(currentInput);
    setIsTyping(false);
    
    const botMessage = { id: Date.now() + 1, text: response, sender: 'bot', timestamp: new Date() };
    setMessages(prev => [...prev, botMessage]);
  };

  const handleKeyPress = (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSend();
    }
  };

  return (
    <div className="flex flex-col h-screen bg-gray-50">
      {showProfileSetup && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white rounded-lg p-6 max-w-md w-full mx-4">
            <h2 className="text-xl font-bold mb-4">Let's get to know you! üòä</h2>
            <form onSubmit={(e) => {
              e.preventDefault();
              const formData = new FormData(e.target);
              saveProfile({
                name: formData.get('name'),
                branch: formData.get('branch'),
                year: formData.get('year'),
                completedTopics: formData.get('completed'),
                currentFocus: formData.get('focus')
              });
            }}>
              <input name="name" placeholder="Your name" className="w-full px-3 py-2 border rounded-lg mb-3" required />
              <select name="branch" className="w-full px-3 py-2 border rounded-lg mb-3" required>
                <option value="">Select Branch</option>
                <option value="CSE">CSE</option>
                <option value="IT">IT</option>
                <option value="ECE">ECE</option>
              </select>
              <select name="year" className="w-full px-3 py-2 border rounded-lg mb-3" required>
                <option value="">Select Year</option>
                <option value="1st">1st Year</option>
                <option value="2nd">2nd Year</option>
                <option value="3rd">3rd Year</option>
                <option value="4th">4th Year</option>
              </select>
              <input name="completed" placeholder="Completed topics (optional)" className="w-full px-3 py-2 border rounded-lg mb-3" />
              <input name="focus" placeholder="Current focus (optional)" className="w-full px-3 py-2 border rounded-lg mb-4" />
              <button type="submit" className="w-full py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">Start Chatting!</button>
            </form>
          </div>
        </div>
      )}

      <div className="bg-white border-b px-6 py-4 shadow-sm">
        <div className="max-w-4xl mx-auto flex items-center justify-between">
          <div>
            <h1 className="text-2xl font-bold text-gray-800">Your Mentor {studentProfile?.name ? `- ${studentProfile.name}` : ''}</h1>
            <p className="text-sm text-gray-500">{studentProfile ? `${studentProfile.branch} | ${studentProfile.year}` : 'Here to guide and support you'}</p>
            <div className="flex gap-1 mt-1">
              <button onClick={() => setManualMode(manualMode === 'MENTOR' ? null : 'MENTOR')} className={`text-xs px-2 py-1 rounded ${manualMode === 'MENTOR' ? 'bg-purple-500 text-white' : 'bg-gray-100'}`}>üíô Mentor</button>
              <button onClick={() => setManualMode(manualMode === 'TEACHER' ? null : 'TEACHER')} className={`text-xs px-2 py-1 rounded ${manualMode === 'TEACHER' ? 'bg-blue-500 text-white' : 'bg-gray-100'}`}>üìö Teacher</button>
              <button onClick={() => setManualMode(manualMode === 'CHAT' ? null : 'CHAT')} className={`text-xs px-2 py-1 rounded ${manualMode === 'CHAT' ? 'bg-green-500 text-white' : 'bg-gray-100'}`}>üí¨ Chat</button>
              {manualMode && <button onClick={() => setManualMode(null)} className="text-xs px-2 py-1 rounded bg-gray-200">Auto</button>}
            </div>
          </div>
          <div className="flex gap-2">
            <button onClick={() => setShowProfileSetup(true)} className="px-4 py-2 text-sm bg-gray-100 hover:bg-gray-200 rounded-lg">Edit</button>
            <button onClick={() => setMessages([{ id: 1, text: "Hey there! I'm so glad you're here. üòä\n\nWhat's on your mind?", sender: 'bot', timestamp: new Date() }])} className="px-4 py-2 text-sm bg-gray-100 hover:bg-gray-200 rounded-lg">New Chat</button>
          </div>
        </div>
      </div>

      <div className="flex-1 overflow-y-auto px-4 py-6">
        <div className="max-w-4xl mx-auto space-y-6">
          {messages.map((message) => (
            <div key={message.id} className={`flex ${message.sender === 'user' ? 'justify-end' : 'justify-start'}`}>
              <div className={`flex gap-3 max-w-3xl ${message.sender === 'user' ? 'flex-row-reverse' : ''}`}>
                <div className={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${message.sender === 'user' ? 'bg-blue-500 text-white' : 'bg-purple-500 text-white'}`}>
                  {message.sender === 'user' ? 'üë§' : 'ü§ñ'}
                </div>
                <div className={`px-4 py-3 rounded-2xl ${message.sender === 'user' ? 'bg-blue-500 text-white' : 'bg-white text-gray-800 shadow-sm border'}`}>
                  <p className="text-sm leading-relaxed whitespace-pre-wrap">{message.text}</p>
                </div>
              </div>
            </div>
          ))}
          {isTyping && (
            <div className="flex justify-start">
              <div className="flex gap-3 max-w-3xl">
                <div className="w-8 h-8 rounded-full bg-purple-500 text-white flex items-center justify-center">ü§ñ</div>
                <div className="px-4 py-3 rounded-2xl bg-white shadow-sm border">
                  <div className="flex gap-1">
                    <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                    <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0.1s' }}></div>
                    <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0.2s' }}></div>
                  </div>
                </div>
              </div>
            </div>
          )}
          <div ref={messagesEndRef} />
        </div>
      </div>

      <div className="bg-white border-t px-4 py-4">
        <div className="max-w-4xl mx-auto">
          <div className="flex gap-3 items-end">
            <div className="flex-1">
              <span className="text-xs text-gray-500">{manualMode ? `${manualMode} Mode (Manual)` : `${currentMode} Mode (Auto)`}</span>
              <textarea value={inputText} onChange={(e) => setInputText(e.target.value)} onKeyPress={handleKeyPress} placeholder="Share what's on your mind..." className="w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none" rows="1" disabled={isTyping} />
            </div>
            <button onClick={handleSend} disabled={!inputText.trim() || isTyping} className="px-6 py-3 bg-blue-500 text-white rounded-xl hover:bg-blue-600 disabled:opacity-50">Send</button>
          </div>
          <p className="text-xs text-gray-400 mt-2 text-center">Every expert was once a beginner. You're doing great! üíô</p>
        </div>
      </div>
    </div>
  );
}

import React, { useState, useRef, useEffect } from 'react';
import { auth, db } from '../firebase';
import { doc, getDoc } from 'firebase/firestore';
import { trackChatbotUsed } from '../utils/analytics';

export default function ChatGPTLikeChatbot() {
  const [isOpen, setIsOpen] = useState(false);
  const [messages, setMessages] = useState([
    {
      id: 1,
      text: "Hi there! I'm your AI assistant. I can help with coding, career advice, explanations, or just have a friendly chat. What's on your mind?",
      sender: 'bot',
      timestamp: new Date()
    }
  ]);
  const [inputText, setInputText] = useState('');
  const [isTyping, setIsTyping] = useState(false);
  const [streamingMessage, setStreamingMessage] = useState('');
  const [conversationHistory, setConversationHistory] = useState([]);
  const [userContext, setUserContext] = useState({
    name: '',
    year: '',
    preferences: {}
  });
  const messagesEndRef = useRef(null);

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages, streamingMessage]);

  // Load user context
  useEffect(() => {
    const loadUserContext = async () => {
      const user = auth.currentUser;
      if (user) {
        try {
          const userDoc = await getDoc(doc(db, 'users', user.uid));
          if (userDoc.exists()) {
            const userData = userDoc.data();
            setUserContext(prev => ({
              ...prev,
              name: userData.name || '',
              year: userData.year || ''
            }));
          }
        } catch (error) {
          console.log('Context load error:', error);
        }
      }
    };
    loadUserContext();
  }, []);

  // Build conversation context for better responses
  const buildConversationContext = () => {
    const recentMessages = messages.slice(-6); // Last 6 messages for context
    const context = recentMessages.map(msg => 
      `${msg.sender === 'user' ? 'User' : 'Assistant'}: ${msg.text}`
    ).join('\n');
    
    return context;
  };

  // Enhanced AI response with human-like conversation
  const getAIResponse = async (userMessage) => {
    setIsTyping(true);
    setStreamingMessage('');
    const startTime = Date.now();
    
    try {
      const GEMINI_API_KEY = import.meta.env.VITE_GEMINI_API_KEY;
      
      if (!GEMINI_API_KEY || GEMINI_API_KEY === 'PASTE_YOUR_NEW_API_KEY_HERE') {
        console.log('No valid API key, using intelligent fallback');
        throw new Error('API key not configured');
      }

      // Build conversation context
      const recentMessages = messages.slice(-8).map(msg => 
        `${msg.sender === 'user' ? 'Human' : 'Assistant'}: ${msg.text}`
      ).join('\n');
      
      const systemPrompt = `You are a helpful, friendly AI assistant. Be conversational, natural, and human-like in your responses.

Conversation history:
${recentMessages}

Human: ${userMessage}

Respond naturally as a helpful AI assistant. Be conversational, use "I" and "you", and provide helpful information. Keep responses focused but friendly.`;

      const requestBody = {
        contents: [{
          parts: [{ text: systemPrompt }]
        }],
        generationConfig: {
          temperature: 0.9,
          topK: 50,
          topP: 0.95,
          maxOutputTokens: 800
        }
      };

      const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(requestBody)
      });
      
      if (!response.ok) {
        console.log(`API request failed with status: ${response.status}`);
        throw new Error(`API failed: ${response.status}`);
      }

      const data = await response.json();
      
      if (data.candidates?.[0]?.content?.parts?.[0]?.text) {
        const aiText = data.candidates[0].content.parts[0].text;
        
        setIsTyping(false);
        await simulateStreaming(aiText);
        
        setConversationHistory(prev => [...prev, 
          { role: 'user', content: userMessage },
          { role: 'assistant', content: aiText }
        ]);
        
        const responseTime = Date.now() - startTime;
        trackChatbotUsed(userMessage, responseTime);
        
        return aiText;
      } else {
        console.log('Invalid API response structure:', data);
        throw new Error('Invalid response structure');
      }
      
    } catch (error) {
      console.error('AI Error:', error.message);
      setIsTyping(false);
      
      const fallback = getHumanLikeFallback(userMessage);
      await simulateStreaming(fallback);
      return fallback;
    }
  };

  // Simulate streaming like ChatGPT
  const simulateStreaming = async (text) => {
    const words = text.split(' ');
    setStreamingMessage('');
    
    for (let i = 0; i < words.length; i++) {
      await new Promise(resolve => setTimeout(resolve, 50)); // Slightly slower for readability
      setStreamingMessage(words.slice(0, i + 1).join(' '));
    }
    setStreamingMessage('');
  };

  // Human-like fallback responses
  const getHumanLikeFallback = (userMessage) => {
    const msg = userMessage.toLowerCase();
    
    // Greetings - be warm and personal
    if (msg.includes('hello') || msg.includes('hi') || msg.includes('hey') || msg.includes('good morning') || msg.includes('good afternoon')) {
      const greetings = [
        "Hey there! üëã Great to meet you! I'm here to help with whatever you need - coding questions, career advice, or just a friendly chat. What's on your mind?",
        "Hi! üòä I'm excited to help you today. Whether you want to talk about programming, get some advice, or explore new ideas together - I'm all ears!",
        "Hello! Nice to see you here! I love helping people learn and solve problems. What would you like to dive into today?"
      ];
      return greetings[Math.floor(Math.random() * greetings.length)];
    }

    // How are you - be conversational
    if (msg.includes('how are you') || msg.includes('how do you do')) {
      return "I'm doing great, thanks for asking! üòä I'm always excited to help people learn new things and solve interesting problems. I find every conversation unique and engaging. How are you doing today? What brings you here?";
    }

    // Programming questions - be encouraging
    if (msg.includes('react') || msg.includes('javascript') || msg.includes('code') || msg.includes('programming')) {
      return "Oh, I love talking about programming! üíª It's such a creative and problem-solving field. Whether you're just starting out or working on something complex, I'm here to help break things down and make them clearer. What specific challenge are you working on? Feel free to share code snippets if you'd like!";
    }

    // Career questions - be supportive
    if (msg.includes('career') || msg.includes('job') || msg.includes('interview') || msg.includes('work')) {
      return "Career development is such an important topic! üöÄ I really enjoy helping people navigate their professional journey. Whether you're looking for advice on skill development, interview prep, or just figuring out your next steps - I'm here to support you. What aspect of your career are you thinking about?";
    }

    // Learning questions - be motivational
    if (msg.includes('learn') || msg.includes('study') || msg.includes('understand') || msg.includes('explain')) {
      return "I absolutely love helping people learn! üìö There's something really rewarding about breaking down complex topics and seeing that 'aha!' moment. I believe everyone can master anything with the right approach and support. What would you like to explore together?";
    }

    // Personal questions - be friendly but appropriate
    if (msg.includes('who are you') || msg.includes('what are you') || msg.includes('tell me about yourself')) {
      return "I'm an AI assistant who genuinely enjoys helping people! ü§ñ I love having conversations about technology, learning, problem-solving, and pretty much anything that sparks curiosity. I try to be helpful, encouraging, and maybe a bit fun too. I'm here to support your goals and answer your questions. What would you like to know or work on together?";
    }

    // Thank you - be gracious
    if (msg.includes('thank') || msg.includes('thanks') || msg.includes('appreciate')) {
      return "You're so welcome! üòä I really enjoy our conversation and I'm glad I could help. Feel free to ask me anything else - I'm always here and happy to assist with whatever you're working on!";
    }

    // Confused or need help
    if (msg.includes('confused') || msg.includes('don\'t understand') || msg.includes('help me') || msg.includes('stuck')) {
      return "I totally get that feeling! ü§î Sometimes things can seem overwhelming, but we can definitely work through it together. I find that breaking problems down into smaller pieces usually helps a lot. Can you tell me more about what's got you stuck? I'm here to help figure it out step by step.";
    }

    // Default responses - be engaging and varied
    const defaultResponses = [
      "That's an interesting question! I'd love to help you with that. Could you tell me a bit more about what you're looking for? I want to make sure I give you the most helpful response possible.",
      "I'm here and ready to help! üòä Whether it's coding, career advice, learning something new, or just having a good conversation - I'm all in. What's on your mind?",
      "Great question! I enjoy tackling all kinds of topics and problems. Feel free to share more details about what you're thinking about, and I'll do my best to provide helpful insights.",
      "I'm excited to help you with whatever you're working on! I find that every question leads to interesting discussions. What would you like to explore together?"
    ];
    
    return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
  };

  const handleSendMessage = async () => {
    if (!inputText.trim()) return;

    const userMessage = {
      id: messages.length + 1,
      text: inputText,
      sender: 'user',
      timestamp: new Date()
    };

    setMessages(prev => [...prev, userMessage]);
    const currentInput = inputText;
    setInputText('');

    const aiResponse = await getAIResponse(currentInput);
    
    const botMessage = {
      id: messages.length + 2,
      text: aiResponse,
      sender: 'bot',
      timestamp: new Date()
    };

    setMessages(prev => [...prev, botMessage]);
  };

  const handleKeyPress = (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSendMessage();
    }
  };

  const clearConversation = () => {
    setMessages([{
      id: 1,
      text: "Hello! I'm your AI assistant. I can help you with programming, career advice, study plans, and much more. What would you like to know?",
      sender: 'bot',
      timestamp: new Date()
    }]);
    setConversationHistory([]);
  };

  const quickPrompts = [
    "Hi! How are you today?",
    "Can you help me understand React hooks?",
    "I'm feeling stuck with my coding project",
    "What's the best way to prepare for interviews?",
    "Explain JavaScript promises to me",
    "I need career advice"
  ];

  return (
    <>
      {/* Chat Toggle Button */}
      <div className="fixed bottom-6 right-6 z-50">
        <button
          onClick={() => setIsOpen(!isOpen)}
          className="w-16 h-16 bg-gradient-to-r from-green-500 to-blue-600 text-white rounded-full shadow-2xl hover:shadow-3xl hover:scale-110 transition-all duration-300 flex items-center justify-center group"
        >
          {isOpen ? (
            <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
          ) : (
            <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 4v-4z" />
            </svg>
          )}
        </button>
        
        <div className="absolute -top-2 -right-2 w-6 h-6 bg-green-500 text-white text-xs rounded-full flex items-center justify-center">
          AI
        </div>
      </div>

      {/* Chat Window */}
      {isOpen && (
        <div className="fixed bottom-24 right-6 w-[420px] h-[600px] bg-white rounded-2xl shadow-2xl z-40 flex flex-col overflow-hidden border border-gray-200">
          {/* Header */}
          <div className="bg-gradient-to-r from-green-500 to-blue-600 text-white p-4 flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                ü§ñ
              </div>
              <div>
                <h3 className="font-semibold">AI Assistant</h3>
                <p className="text-xs text-green-100">Just like ChatGPT, but better! üòä</p>
              </div>
            </div>
            <div className="flex items-center gap-2">
              <button
                onClick={clearConversation}
                className="text-white/80 hover:text-white p-1 rounded"
                title="Clear conversation"
              >
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
              </button>
              <button
                onClick={() => setIsOpen(false)}
                className="text-white/80 hover:text-white"
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
          </div>

          {/* Messages */}
          <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50">
            {messages.map((message) => (
              <div
                key={message.id}
                className={`flex ${message.sender === 'user' ? 'justify-end' : 'justify-start'}`}
              >
                <div
                  className={`max-w-[85%] p-4 rounded-2xl ${
                    message.sender === 'user'
                      ? 'bg-blue-600 text-white'
                      : 'bg-white text-gray-800 shadow-sm border'
                  }`}
                >
                  <p className="text-sm whitespace-pre-line leading-relaxed">{message.text}</p>
                  <p className="text-xs mt-2 opacity-70">
                    {message.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                  </p>
                </div>
              </div>
            ))}
            
            {/* Streaming Message */}
            {streamingMessage && (
              <div className="flex justify-start">
                <div className="max-w-[85%] p-4 rounded-2xl bg-white text-gray-800 shadow-sm border">
                  <p className="text-sm whitespace-pre-line leading-relaxed">{streamingMessage}<span className="animate-pulse">|</span></p>
                </div>
              </div>
            )}
            
            {/* Typing Indicator */}
            {isTyping && !streamingMessage && (
              <div className="flex justify-start">
                <div className="bg-white p-4 rounded-2xl shadow-sm border">
                  <div className="flex space-x-1">
                    <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                    <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0.1s' }}></div>
                    <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0.2s' }}></div>
                  </div>
                </div>
              </div>
            )}
            
            <div ref={messagesEndRef} />
          </div>

          {/* Quick Prompts */}
          {messages.length <= 1 && (
            <div className="p-4 border-t bg-white">
              <p className="text-xs text-gray-600 mb-3 font-medium">Try these prompts:</p>
              <div className="grid grid-cols-1 gap-2">
                {quickPrompts.map((prompt, index) => (
                  <button
                    key={index}
                    onClick={() => setInputText(prompt)}
                    className="text-left text-xs bg-gray-50 p-3 rounded-lg hover:bg-gray-100 transition-colors border border-gray-200 hover:border-gray-300"
                  >
                    {prompt}
                  </button>
                ))}
              </div>
            </div>
          )}

          {/* Input */}
          <div className="p-4 border-t bg-white">
            <div className="flex gap-3">
              <input
                type="text"
                value={inputText}
                onChange={(e) => setInputText(e.target.value)}
                onKeyPress={handleKeyPress}
                placeholder="Message AI Assistant..."
                className="flex-1 px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm resize-none"
                disabled={isTyping}
              />
              <button
                onClick={handleSendMessage}
                disabled={!inputText.trim() || isTyping}
                className="w-12 h-12 bg-blue-600 text-white rounded-xl hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center transition-colors"
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                </svg>
              </button>
            </div>
          </div>
        </div>
      )}
    </>
  );
}
export default function CircularProgress({ percentage, size = 120 }) {
  const strokeWidth = 8;
  const radius = (size - strokeWidth) / 2;
  const circumference = radius * 2 * Math.PI;
  const offset = circumference - (percentage / 100) * circumference;

  return (
    <div className="relative inline-flex items-center justify-center">
      <svg width={size} height={size} className="transform -rotate-90">
        {/* Background circle */}
        <circle
          cx={size / 2}
          cy={size / 2}
          r={radius}
          stroke="#E0E7FF"
          strokeWidth={strokeWidth}
          fill="none"
        />
        {/* Progress circle */}
        <circle
          cx={size / 2}
          cy={size / 2}
          r={radius}
          stroke="url(#gradient)"
          strokeWidth={strokeWidth}
          fill="none"
          strokeDasharray={circumference}
          strokeDashoffset={offset}
          strokeLinecap="round"
          className="transition-all duration-500"
        />
        <defs>
          <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stopColor="#A78BFA" />
            <stop offset="100%" stopColor="#38BDF8" />
          </linearGradient>
        </defs>
      </svg>
      <div className="absolute text-center">
        <span className="text-2xl font-bold text-gray-800">{percentage}%</span>
      </div>
    </div>
  );
}

export default function Footer() {
  return (
    <footer className="bg-blue-800 text-white py-8 mt-auto">
      <div className="max-w-4xl mx-auto px-4 text-center">
        <p className="text-gray-300">¬© 2024 Career Roadmap. Built for students.</p>
      </div>
    </footer>
  )
}
import React, { useState, useRef, useEffect } from 'react';
import { auth, db } from '../firebase';
import { doc, getDoc } from 'firebase/firestore';
import { trackChatbotUsed } from '../utils/analytics';

export default function GoogleSearchChatGPT() {
  const [isOpen, setIsOpen] = useState(false);
  const [messages, setMessages] = useState([
    {
      id: 1,
      text: "Hi! I can search Google and get you real-time information on any topic. Just ask me anything and I'll fetch the latest content from the web! üîç",
      sender: 'bot',
      timestamp: new Date()
    }
  ]);
  const [inputText, setInputText] = useState('');
  const [isTyping, setIsTyping] = useState(false);
  const [isSearching, setIsSearching] = useState(false);
  const [streamingMessage, setStreamingMessage] = useState('');
  const messagesEndRef = useRef(null);

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages, streamingMessage]);

  // Real Google search function
  const searchGoogle = async (query) => {
    try {
      setIsSearching(true);
      
      // Using SerpAPI for real Google search results
      const SERPAPI_KEY = 'demo'; // You can get free API key from serpapi.com
      
      const response = await fetch(`https://serpapi.com/search.json?engine=google&q=${encodeURIComponent(query)}&api_key=${SERPAPI_KEY}&num=5`);
      
      if (!response.ok) {
        // Fallback to web scraping method
        return await fallbackSearch(query);
      }
      
      const data = await response.json();
      
      const searchResults = {
        query: query,
        results: data.organic_results || [],
        answer_box: data.answer_box,
        knowledge_graph: data.knowledge_graph
      };
      
      setIsSearching(false);
      return searchResults;
      
    } catch (error) {
      console.log('Search error:', error);
      setIsSearching(false);
      return await fallbackSearch(query);
    }
  };

  // Fallback search using web scraping
  const fallbackSearch = async (query) => {
    try {
      // Using a CORS proxy to search Google
      const proxyUrl = 'https://api.allorigins.win/get?url=';
      const googleUrl = `https://www.google.com/search?q=${encodeURIComponent(query)}&num=5`;
      
      const response = await fetch(proxyUrl + encodeURIComponent(googleUrl));
      const data = await response.json();
      
      // Extract basic information from HTML (simplified)
      const htmlContent = data.contents;
      
      // Simple extraction of search snippets
      const snippets = [];
      const snippetRegex = /<span class="st">(.*?)<\/span>/g;
      let match;
      
      while ((match = snippetRegex.exec(htmlContent)) !== null && snippets.length < 3) {
        snippets.push(match[1].replace(/<[^>]*>/g, ''));
      }
      
      return {
        query: query,
        results: snippets.map((snippet, index) => ({
          title: `Result ${index + 1}`,
          snippet: snippet
        })),
        hasResults: snippets.length > 0
      };
      
    } catch (error) {
      console.log('Fallback search error:', error);
      return {
        query: query,
        results: [],
        hasResults: false,
        error: 'Search temporarily unavailable'
      };
    }
  };

  // AI response with Google search integration
  const getSearchResponse = async (userMessage) => {
    setIsTyping(true);
    setStreamingMessage('');
    const startTime = Date.now();
    
    try {
      // First, search Google for the query
      const searchResults = await searchGoogle(userMessage);
      
      const GEMINI_API_KEY = import.meta.env.VITE_GEMINI_API_KEY;
      
      if (!GEMINI_API_KEY || GEMINI_API_KEY === 'PASTE_YOUR_NEW_API_KEY_HERE') {
        throw new Error('API key not configured');
      }

      // Build search context for AI
      let searchContext = '';
      if (searchResults.hasResults !== false) {
        searchContext = `
GOOGLE SEARCH RESULTS for "${searchResults.query}":

${searchResults.answer_box ? `Direct Answer: ${JSON.stringify(searchResults.answer_box)}` : ''}

${searchResults.knowledge_graph ? `Knowledge Graph: ${JSON.stringify(searchResults.knowledge_graph)}` : ''}

Search Results:
${searchResults.results.map((result, index) => 
  `${index + 1}. ${result.title || 'Result'}: ${result.snippet || result}`
).join('\n')}
`;
      }
      
      const searchPrompt = `You are an AI assistant with access to real-time Google search results. Use the search results to provide accurate, current information.

${searchContext}

User Question: "${userMessage}"

Instructions:
- Use the Google search results above to answer the user's question
- Provide accurate, up-to-date information based on the search results
- If search results are available, reference them in your response
- Be conversational and helpful
- Include specific details from the search results
- If no search results, provide general knowledge response

Provide a comprehensive response based on the search results:`;

      const requestBody = {
        contents: [{
          parts: [{ text: searchPrompt }]
        }],
        generationConfig: {
          temperature: 0.7,
          topK: 40,
          topP: 0.9,
          maxOutputTokens: 1200
        }
      };

      const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(requestBody)
      });
      
      if (!response.ok) {
        throw new Error(`API failed: ${response.status}`);
      }

      const data = await response.json();
      
      if (data.candidates?.[0]?.content?.parts?.[0]?.text) {
        let aiText = data.candidates[0].content.parts[0].text;
        
        // Add search indicator
        if (searchResults.hasResults !== false) {
          aiText = `üîç *Based on current Google search results*\n\n${aiText}`;
        }
        
        setIsTyping(false);
        await simulateStreaming(aiText);
        
        const responseTime = Date.now() - startTime;
        trackChatbotUsed(userMessage, responseTime);
        
        return aiText;
      } else {
        throw new Error('Invalid response structure');
      }
      
    } catch (error) {
      console.error('Search Response Error:', error.message);
      setIsTyping(false);
      
      const fallback = getSearchFallback(userMessage);
      await simulateStreaming(fallback);
      return fallback;
    }
  };

  // Simulate streaming
  const simulateStreaming = async (text) => {
    const words = text.split(' ');
    setStreamingMessage('');
    
    for (let i = 0; i < words.length; i++) {
      await new Promise(resolve => setTimeout(resolve, 60));
      setStreamingMessage(words.slice(0, i + 1).join(' '));
    }
    setStreamingMessage('');
  };

  // Search-aware fallback
  const getSearchFallback = (userMessage) => {
    const msg = userMessage.toLowerCase();
    
    if (msg.includes('what is') || msg.includes('define') || msg.includes('explain')) {
      return `üîç *Searching Google for: "${userMessage}"*

I'm having trouble accessing Google search right now, but I can still help you with comprehensive information based on my knowledge!

For questions like "${userMessage}", I typically search for:
‚Ä¢ Latest definitions and explanations
‚Ä¢ Current examples and use cases  
‚Ä¢ Recent developments and trends
‚Ä¢ Expert opinions and best practices

What specific aspect would you like me to focus on? I can provide detailed information even without live search results!`;
    }

    if (msg.includes('latest') || msg.includes('current') || msg.includes('recent') || msg.includes('2024') || msg.includes('2025')) {
      return `üîç *Attempting to search Google for current information*

I'm designed to fetch the latest information from Google for queries like yours. While I'm having connectivity issues with live search right now, I can still provide you with:

‚Ä¢ **Current trends** and developments I'm aware of
‚Ä¢ **Recent updates** in the field you're asking about
‚Ä¢ **Best practices** as of recent knowledge
‚Ä¢ **Reliable sources** where you can find the latest information

Could you be more specific about what current information you're looking for? I'll do my best to help with what I know!`;
    }

    return `üîç *Google Search Integration Active*

I'm designed to search Google and bring you real-time information on any topic! I can help you find:

‚Ä¢ **Current news** and updates
‚Ä¢ **Latest information** on any subject
‚Ä¢ **Recent developments** in technology, science, etc.
‚Ä¢ **Up-to-date facts** and statistics
‚Ä¢ **Current trends** and best practices

What would you like me to search Google for? Just ask me anything like:
- "What's the latest news about AI?"
- "Current JavaScript frameworks 2024"
- "Recent developments in machine learning"
- "Latest programming trends"

I'll fetch the most current information from Google for you!`;
  };

  const handleSendMessage = async () => {
    if (!inputText.trim()) return;

    const userMessage = {
      id: messages.length + 1,
      text: inputText,
      sender: 'user',
      timestamp: new Date()
    };

    setMessages(prev => [...prev, userMessage]);
    const currentInput = inputText;
    setInputText('');

    const aiResponse = await getSearchResponse(currentInput);
    
    const botMessage = {
      id: messages.length + 2,
      text: aiResponse,
      sender: 'bot',
      timestamp: new Date()
    };

    setMessages(prev => [...prev, botMessage]);
  };

  const handleKeyPress = (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSendMessage();
    }
  };

  const clearConversation = () => {
    setMessages([{
      id: 1,
      text: "Hi! I can search Google and get you real-time information on any topic. Just ask me anything and I'll fetch the latest content from the web! üîç",
      sender: 'bot',
      timestamp: new Date()
    }]);
  };

  const searchPrompts = [
    "What is artificial intelligence?",
    "Latest JavaScript frameworks 2024",
    "Current trends in web development",
    "What is machine learning?",
    "Recent news about technology",
    "Best programming languages to learn"
  ];

  return (
    <>
      {/* Chat Toggle Button */}
      <div className="fixed bottom-6 right-6 z-50">
        <button
          onClick={() => setIsOpen(!isOpen)}
          className="w-16 h-16 bg-gradient-to-r from-green-500 via-blue-500 to-purple-600 text-white rounded-full shadow-2xl hover:shadow-3xl hover:scale-110 transition-all duration-300 flex items-center justify-center group relative overflow-hidden"
        >
          <div className="absolute inset-0 bg-gradient-to-r from-green-400 to-purple-400 opacity-0 group-hover:opacity-30 transition-opacity duration-300"></div>
          {isOpen ? (
            <svg className="w-8 h-8 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
          ) : (
            <svg className="w-8 h-8 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
          )}
        </button>
        
        <div className="absolute -top-2 -right-2 w-6 h-6 bg-gradient-to-r from-red-400 to-orange-500 text-white text-xs rounded-full flex items-center justify-center animate-pulse font-bold">
          üîç
        </div>
      </div>

      {/* Google Search Chat Window */}
      {isOpen && (
        <div className="fixed bottom-24 right-6 w-[520px] h-[750px] bg-white rounded-3xl shadow-2xl z-40 flex flex-col overflow-hidden border border-gray-200">
          {/* Header */}
          <div className="bg-gradient-to-r from-green-500 via-blue-500 to-purple-600 text-white p-5 flex items-center justify-between relative overflow-hidden">
            <div className="absolute inset-0 bg-gradient-to-r from-green-400 to-purple-400 opacity-20"></div>
            <div className="flex items-center gap-3 relative z-10">
              <div className="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm">
                <span className="text-xl">üîç</span>
              </div>
              <div>
                <h3 className="font-bold text-lg">Google Search AI</h3>
                <p className="text-xs text-green-100">Real-time web search results</p>
              </div>
            </div>
            <div className="flex items-center gap-2 relative z-10">
              <button
                onClick={clearConversation}
                className="text-white/80 hover:text-white p-2 rounded-lg hover:bg-white/10 transition-colors"
                title="New search session"
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
              </button>
              <button
                onClick={() => setIsOpen(false)}
                className="text-white/80 hover:text-white p-1 rounded-lg hover:bg-white/10 transition-colors"
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
          </div>

          {/* Messages Area */}
          <div className="flex-1 overflow-y-auto p-5 space-y-4 bg-gradient-to-b from-green-50 to-white">
            {messages.map((message) => (
              <div
                key={message.id}
                className={`flex ${message.sender === 'user' ? 'justify-end' : 'justify-start'}`}
              >
                <div
                  className={`max-w-[85%] p-4 rounded-2xl ${
                    message.sender === 'user'
                      ? 'bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg'
                      : 'bg-white text-gray-800 shadow-md border border-green-100'
                  }`}
                >
                  <p className="text-sm whitespace-pre-line leading-relaxed">{message.text}</p>
                  <p className="text-xs mt-2 opacity-70">
                    {message.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                  </p>
                </div>
              </div>
            ))}
            
            {/* Streaming Message */}
            {streamingMessage && (
              <div className="flex justify-start">
                <div className="max-w-[85%] p-4 rounded-2xl bg-white text-gray-800 shadow-md border border-green-100">
                  <p className="text-sm whitespace-pre-line leading-relaxed">
                    {streamingMessage}
                    <span className="inline-block w-2 h-5 bg-green-500 ml-1 animate-pulse rounded"></span>
                  </p>
                </div>
              </div>
            )}
            
            {/* Search/Typing Indicator */}
            {(isTyping || isSearching) && !streamingMessage && (
              <div className="flex justify-start">
                <div className="bg-white p-4 rounded-2xl shadow-md border border-green-100">
                  <div className="flex items-center space-x-2">
                    <div className="flex space-x-1">
                      <div className="w-2 h-2 bg-green-500 rounded-full animate-bounce"></div>
                      <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style={{ animationDelay: '0.1s' }}></div>
                      <div className="w-2 h-2 bg-purple-500 rounded-full animate-bounce" style={{ animationDelay: '0.2s' }}></div>
                    </div>
                    <span className="text-xs text-gray-500">
                      {isSearching ? 'üîç Searching Google...' : 'ü§ñ Processing results...'}
                    </span>
                  </div>
                </div>
              </div>
            )}
            
            <div ref={messagesEndRef} />
          </div>

          {/* Search Prompts */}
          {messages.length <= 1 && (
            <div className="p-5 border-t bg-gradient-to-r from-green-50 to-blue-50">
              <p className="text-xs text-gray-600 mb-3 font-semibold">üîç Try searching for:</p>
              <div className="grid grid-cols-1 gap-2">
                {searchPrompts.slice(0, 3).map((prompt, index) => (
                  <button
                    key={index}
                    onClick={() => setInputText(prompt)}
                    className="text-left text-xs bg-gradient-to-r from-green-50 to-blue-50 p-3 rounded-xl hover:from-green-100 hover:to-blue-100 transition-all duration-200 border border-green-200 hover:border-blue-300 hover:shadow-md"
                  >
                    {prompt}
                  </button>
                ))}
              </div>
            </div>
          )}

          {/* Input Area */}
          <div className="p-5 border-t bg-white">
            <div className="flex gap-3 items-end">
              <div className="flex-1 relative">
                <textarea
                  value={inputText}
                  onChange={(e) => setInputText(e.target.value)}
                  onKeyPress={handleKeyPress}
                  placeholder="Ask me anything - I'll search Google for you!"
                  className="w-full px-4 py-3 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm resize-none max-h-24 min-h-[48px]"
                  disabled={isTyping || isSearching}
                  rows={1}
                />
              </div>
              <button
                onClick={handleSendMessage}
                disabled={!inputText.trim() || isTyping || isSearching}
                className="w-12 h-12 bg-gradient-to-r from-green-600 to-blue-600 text-white rounded-2xl hover:from-green-700 hover:to-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl"
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
              </button>
            </div>
          </div>
        </div>
      )}
    </>
  );
}
import React, { useState, useRef, useEffect } from 'react';
import { auth, db } from '../firebase';
import { doc, getDoc } from 'firebase/firestore';
import { trackChatbotUsed } from '../utils/analytics';

export default function HumanLikeChatGPT() {
  const [isOpen, setIsOpen] = useState(false);
  const [messages, setMessages] = useState([
    {
      id: 1,
      text: "Hey there! üëã I'm your AI buddy. I love chatting about coding, career stuff, or just helping you figure things out. What's on your mind today?",
      sender: 'bot',
      timestamp: new Date()
    }
  ]);
  const [inputText, setInputText] = useState('');
  const [isTyping, setIsTyping] = useState(false);
  const [streamingMessage, setStreamingMessage] = useState('');
  const [conversationHistory, setConversationHistory] = useState([]);
  const [userName, setUserName] = useState('');
  const messagesEndRef = useRef(null);

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages, streamingMessage]);

  // Load user context
  useEffect(() => {
    const loadUserContext = async () => {
      const user = auth.currentUser;
      if (user) {
        try {
          const userDoc = await getDoc(doc(db, 'users', user.uid));
          if (userDoc.exists()) {
            const userData = userDoc.data();
            setUserName(userData.name || '');
          }
        } catch (error) {
          console.log('Context load error:', error);
        }
      }
    };
    loadUserContext();
  }, []);

  // Human-like AI response
  const getHumanResponse = async (userMessage) => {
    setIsTyping(true);
    setStreamingMessage('');
    const startTime = Date.now();
    
    try {
      const GEMINI_API_KEY = import.meta.env.VITE_GEMINI_API_KEY;
      
      if (!GEMINI_API_KEY || GEMINI_API_KEY === 'PASTE_YOUR_NEW_API_KEY_HERE') {
        throw new Error('API key not configured');
      }

      // Build conversation context
      const recentMessages = messages.slice(-8).map(msg => 
        `${msg.sender === 'user' ? 'Human' : 'AI'}: ${msg.text}`
      ).join('\n');
      
      const humanPrompt = `You are a friendly, helpful AI assistant having a natural conversation. Be conversational, use "I" and "you", show personality, and be genuinely helpful.

Previous conversation:
${recentMessages}

Human just said: "${userMessage}"

Respond naturally like you're chatting with a friend. Be helpful, conversational, and show personality. Use casual language, contractions, and be genuinely interested in helping them.`;

      const requestBody = {
        contents: [{
          parts: [{ text: humanPrompt }]
        }],
        generationConfig: {
          temperature: 0.9,
          topK: 50,
          topP: 0.95,
          maxOutputTokens: 800
        }
      };

      const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(requestBody)
      });
      
      if (!response.ok) {
        console.log(`API Error: ${response.status}`);
        throw new Error(`API failed: ${response.status}`);
      }

      const data = await response.json();
      
      if (data.candidates?.[0]?.content?.parts?.[0]?.text) {
        let aiText = data.candidates[0].content.parts[0].text;
        
        setIsTyping(false);
        await simulateHumanTyping(aiText);
        
        setConversationHistory(prev => [...prev, 
          { role: 'user', content: userMessage },
          { role: 'assistant', content: aiText }
        ]);
        
        const responseTime = Date.now() - startTime;
        trackChatbotUsed(userMessage, responseTime);
        
        return aiText;
      } else {
        throw new Error('Invalid response structure');
      }
      
    } catch (error) {
      console.error('AI Error:', error.message);
      setIsTyping(false);
      
      const fallback = getPersonalizedFallback(userMessage);
      await simulateHumanTyping(fallback);
      return fallback;
    }
  };

  // Human-like typing simulation
  const simulateHumanTyping = async (text) => {
    const words = text.split(' ');
    setStreamingMessage('');
    
    for (let i = 0; i < words.length; i++) {
      // Variable typing speed like humans
      const delay = words[i].length > 6 ? 80 : 60;
      await new Promise(resolve => setTimeout(resolve, delay + Math.random() * 40));
      
      setStreamingMessage(words.slice(0, i + 1).join(' '));
      
      // Pause at punctuation like humans do
      if (words[i].includes('.') || words[i].includes('!') || words[i].includes('?')) {
        await new Promise(resolve => setTimeout(resolve, 300));
      }
    }
    setStreamingMessage('');
  };

  // Personalized fallback responses
  const getPersonalizedFallback = (userMessage) => {
    const msg = userMessage.toLowerCase();
    const name = userName ? `, ${userName}` : '';
    
    // Language choice for DSA
    if (msg.includes('python or c++') || (msg.includes('language') && msg.includes('dsa'))) {
      return `Oh${name}, great question! ü§î So you're trying to decide between Python and C++ for DSA? I totally get why this is confusing!

Here's my honest take: **Go with Python first**. I know, I know - everyone says C++ is faster, but hear me out! 

When you're learning DSA concepts, Python lets you focus on the *logic* instead of wrestling with syntax. Like, you can write a binary search in 5 lines instead of 15! Plus, most companies (Google, Facebook, etc.) are totally cool with Python in interviews.

Here's what I'd do if I were you:
‚Ä¢ **Month 1-2:** Learn Python + basic DSA (arrays, strings)
‚Ä¢ **Month 3-4:** Get comfortable with trees, graphs in Python  
‚Ä¢ **Month 5+:** If you want speed for competitive programming, then learn C++

The thing is${name}, understanding *how* algorithms work is way more important than which language you use. Once you get the concepts in Python, switching to C++ later is pretty easy.

What do you think? Are you leaning towards one already, or still totally unsure? üòä`;
    }

    // LeetCode and platforms
    if (msg.includes('leetcode') || msg.includes('coding platform') || msg.includes('practice')) {
      return `Ah${name}, looking for good coding practice sites? You've come to the right place! üòÑ

**LeetCode** is definitely the king - https://leetcode.com/. Like, if you're serious about getting into good companies, this is where you'll spend most of your time. They have problems sorted by company (Google, Amazon, etc.) which is super helpful!

But honestly? Don't just stick to one platform. Here's what I'd recommend:

**Start here:**
‚Ä¢ **GeeksforGeeks** - Amazing for learning concepts first
‚Ä¢ **HackerRank** - Great for beginners, builds confidence

**Then move to:**
‚Ä¢ **LeetCode** - The main event for interview prep
‚Ä¢ **CodeChef** - If you want to try competitive programming

**Pro tip${name}:** Start with GeeksforGeeks to understand the theory, then jump to LeetCode to practice. Don't go straight to LeetCode - you'll just get frustrated!

I usually tell people to solve like 2-3 easy problems daily rather than trying to do 10 in one day and then burning out. Consistency beats intensity every time!

Which one sounds good to start with? Or are you already using any of these? ü§ì`;
    }

    // DSA learning
    if (msg.includes('dsa') || msg.includes('data structures') || msg.includes('algorithms')) {
      return `Hey${name}! DSA questions - I love these! üöÄ It's like the foundation of everything in programming, right?

So here's the thing about DSA - it seems super overwhelming at first (trust me, we've all been there!), but once you get the hang of it, it's actually pretty fun. Like solving puzzles!

**Here's how I'd approach it:**

**Week 1-2: Arrays & Strings**
Start simple! Two pointers, sliding window - these patterns show up EVERYWHERE. Do like 20-30 easy problems just to get comfortable.

**Week 3-4: Linked Lists & Stacks**
These teach you pointer manipulation. Super important for interviews!

**Month 2: Trees**
This is where it gets interesting! Binary trees, BSTs - once you nail tree traversals, you'll feel like a coding wizard üßô‚Äç‚ôÇÔ∏è

**Month 3: Graphs & DP**
The final boss levels! But by this point, you'll be ready.

The key${name} is to not rush it. I see so many people trying to learn everything in 2 weeks and then giving up. Take your time, understand each concept properly.

What's your current level? Complete beginner or have you done some programming before? That'll help me give you more specific advice! üòä`;
    }

    // Career guidance
    if (msg.includes('career') || msg.includes('job') || msg.includes('placement') || msg.includes('interview')) {
      return `Oh${name}, career planning! This is such an important topic, and I'm excited you're thinking about it early! üåü

You know what? The job market right now is actually pretty good for developers, but it's also competitive. The companies that are hiring are looking for people who really know their stuff.

**Here's what's working in 2024:**

**For getting interviews:**
‚Ä¢ Strong DSA skills (yeah, I know, everyone says this!)
‚Ä¢ 2-3 solid projects that actually work and look good
‚Ä¢ A clean GitHub profile that shows you code regularly

**For acing interviews:**
‚Ä¢ Being able to explain your thought process clearly
‚Ä¢ Knowing your projects inside and out
‚Ä¢ Having good communication skills (this is HUGE!)

**Package-wise**, I'm seeing:
‚Ä¢ Service companies: 4-8 LPA for freshers
‚Ä¢ Product companies: 8-15 LPA  
‚Ä¢ Top tier (FAANG): 15+ LPA

But honestly${name}, don't just chase the money. Find a place where you'll learn and grow. A good first job teaches you more than any course ever will!

What stage are you at right now? Still studying or getting ready to apply? And what kind of companies interest you most? ü§î`;
    }

    // Greetings
    if (msg.includes('hello') || msg.includes('hi') || msg.includes('hey')) {
      const greetings = [
        `Hey${name}! üòä Great to see you here! I'm really excited to chat with you. What's going on in your world today?`,
        `Hi there${name}! üëã I'm so glad you stopped by. I love helping people with coding, career stuff, or just having good conversations. What's on your mind?`,
        `Hello${name}! üåü Nice to meet you! I'm here to help with whatever you're working on - whether it's technical stuff, career questions, or just brainstorming. What can we dive into together?`
      ];
      return greetings[Math.floor(Math.random() * greetings.length)];
    }

    // Default personalized response
    const defaults = [
      `That's a really interesting question${name}! I love how you're thinking about this. Let me share what I know and see if we can figure this out together. What specific part of this are you most curious about?`,
      `Great question${name}! ü§î I can tell you're really thinking deeply about this stuff, which I totally respect. Let me break down what I know about this topic and we can explore it together!`,
      `Oh${name}, this is exactly the kind of thing I enjoy discussing! There's actually quite a bit to unpack here. What's your current understanding of this? I'd love to build on what you already know!`
    ];
    
    return defaults[Math.floor(Math.random() * defaults.length)];
  };

  const handleSendMessage = async () => {
    if (!inputText.trim()) return;

    const userMessage = {
      id: messages.length + 1,
      text: inputText,
      sender: 'user',
      timestamp: new Date()
    };

    setMessages(prev => [...prev, userMessage]);
    const currentInput = inputText;
    setInputText('');

    const aiResponse = await getHumanResponse(currentInput);
    
    const botMessage = {
      id: messages.length + 2,
      text: aiResponse,
      sender: 'bot',
      timestamp: new Date()
    };

    setMessages(prev => [...prev, botMessage]);
  };

  const handleKeyPress = (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSendMessage();
    }
  };

  const clearConversation = () => {
    setMessages([{
      id: 1,
      text: "Hey there! üëã I'm your AI buddy. I love chatting about coding, career stuff, or just helping you figure things out. What's on your mind today?",
      sender: 'bot',
      timestamp: new Date()
    }]);
    setConversationHistory([]);
  };

  const casualPrompts = [
    "Hey! How's it going?",
    "Python or C++ for DSA? I'm confused üòÖ",
    "What's the best way to practice coding?",
    "I'm feeling overwhelmed with placement prep",
    "Can you help me understand algorithms?",
    "What should I focus on for my career?"
  ];

  return (
    <>
      {/* Chat Toggle Button */}
      <div className="fixed bottom-6 right-6 z-50">
        <button
          onClick={() => setIsOpen(!isOpen)}
          className="w-16 h-16 bg-gradient-to-r from-pink-500 via-purple-500 to-indigo-500 text-white rounded-full shadow-2xl hover:shadow-3xl hover:scale-110 transition-all duration-300 flex items-center justify-center group relative overflow-hidden"
        >
          <div className="absolute inset-0 bg-gradient-to-r from-pink-400 to-indigo-400 opacity-0 group-hover:opacity-30 transition-opacity duration-300"></div>
          {isOpen ? (
            <svg className="w-8 h-8 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
          ) : (
            <svg className="w-8 h-8 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
            </svg>
          )}
        </button>
        
        <div className="absolute -top-2 -right-2 w-6 h-6 bg-gradient-to-r from-yellow-400 to-orange-500 text-white text-xs rounded-full flex items-center justify-center animate-bounce font-bold">
          üòä
        </div>
      </div>

      {/* Human-like Chat Window */}
      {isOpen && (
        <div className="fixed bottom-24 right-6 w-[500px] h-[720px] bg-white rounded-3xl shadow-2xl z-40 flex flex-col overflow-hidden border border-gray-200">
          {/* Header */}
          <div className="bg-gradient-to-r from-pink-500 via-purple-500 to-indigo-500 text-white p-5 flex items-center justify-between relative overflow-hidden">
            <div className="absolute inset-0 bg-gradient-to-r from-pink-400 to-indigo-400 opacity-20"></div>
            <div className="flex items-center gap-3 relative z-10">
              <div className="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm">
                <span className="text-xl">üòä</span>
              </div>
              <div>
                <h3 className="font-bold text-lg">Your AI Buddy</h3>
                <p className="text-xs text-pink-100">Friendly, helpful, and human-like!</p>
              </div>
            </div>
            <div className="flex items-center gap-2 relative z-10">
              <button
                onClick={clearConversation}
                className="text-white/80 hover:text-white p-2 rounded-lg hover:bg-white/10 transition-colors"
                title="Fresh start"
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
              </button>
              <button
                onClick={() => setIsOpen(false)}
                className="text-white/80 hover:text-white p-1 rounded-lg hover:bg-white/10 transition-colors"
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
          </div>

          {/* Messages Area */}
          <div className="flex-1 overflow-y-auto p-5 space-y-4 bg-gradient-to-b from-purple-50 to-white">
            {messages.map((message) => (
              <div
                key={message.id}
                className={`flex ${message.sender === 'user' ? 'justify-end' : 'justify-start'}`}
              >
                <div
                  className={`max-w-[85%] p-4 rounded-2xl ${
                    message.sender === 'user'
                      ? 'bg-gradient-to-r from-purple-600 to-pink-600 text-white shadow-lg'
                      : 'bg-white text-gray-800 shadow-md border border-purple-100'
                  }`}
                >
                  <p className="text-sm whitespace-pre-line leading-relaxed">{message.text}</p>
                  <p className="text-xs mt-2 opacity-70">
                    {message.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                  </p>
                </div>
              </div>
            ))}
            
            {/* Streaming Message */}
            {streamingMessage && (
              <div className="flex justify-start">
                <div className="max-w-[85%] p-4 rounded-2xl bg-white text-gray-800 shadow-md border border-purple-100">
                  <p className="text-sm whitespace-pre-line leading-relaxed">
                    {streamingMessage}
                    <span className="inline-block w-2 h-5 bg-purple-500 ml-1 animate-pulse rounded"></span>
                  </p>
                </div>
              </div>
            )}
            
            {/* Typing Indicator */}
            {isTyping && !streamingMessage && (
              <div className="flex justify-start">
                <div className="bg-white p-4 rounded-2xl shadow-md border border-purple-100">
                  <div className="flex items-center space-x-2">
                    <div className="flex space-x-1">
                      <div className="w-2 h-2 bg-pink-500 rounded-full animate-bounce"></div>
                      <div className="w-2 h-2 bg-purple-500 rounded-full animate-bounce" style={{ animationDelay: '0.1s' }}></div>
                      <div className="w-2 h-2 bg-indigo-500 rounded-full animate-bounce" style={{ animationDelay: '0.2s' }}></div>
                    </div>
                    <span className="text-xs text-gray-500">üòä Thinking...</span>
                  </div>
                </div>
              </div>
            )}
            
            <div ref={messagesEndRef} />
          </div>

          {/* Casual Prompts */}
          {messages.length <= 1 && (
            <div className="p-5 border-t bg-gradient-to-r from-purple-50 to-pink-50">
              <p className="text-xs text-gray-600 mb-3 font-semibold">üòä Let's chat about:</p>
              <div className="grid grid-cols-1 gap-2">
                {casualPrompts.slice(0, 3).map((prompt, index) => (
                  <button
                    key={index}
                    onClick={() => setInputText(prompt)}
                    className="text-left text-xs bg-gradient-to-r from-pink-50 to-purple-50 p-3 rounded-xl hover:from-pink-100 hover:to-purple-100 transition-all duration-200 border border-pink-200 hover:border-purple-300 hover:shadow-md"
                  >
                    {prompt}
                  </button>
                ))}
              </div>
            </div>
          )}

          {/* Input Area */}
          <div className="p-5 border-t bg-white">
            <div className="flex gap-3 items-end">
              <div className="flex-1 relative">
                <textarea
                  value={inputText}
                  onChange={(e) => setInputText(e.target.value)}
                  onKeyPress={handleKeyPress}
                  placeholder="Just chat with me like a friend! üòä"
                  className="w-full px-4 py-3 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm resize-none max-h-24 min-h-[48px]"
                  disabled={isTyping}
                  rows={1}
                />
              </div>
              <button
                onClick={handleSendMessage}
                disabled={!inputText.trim() || isTyping}
                className="w-12 h-12 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-2xl hover:from-purple-700 hover:to-pink-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl"
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                </svg>
              </button>
            </div>
          </div>
        </div>
      )}
    </>
  );
}
import React, { useState, useRef, useEffect } from 'react';
import { auth, db } from '../firebase';
import { doc, getDoc } from 'firebase/firestore';
import { trackChatbotUsed } from '../utils/analytics';

export default function IntelligentChatGPT() {
  const [isOpen, setIsOpen] = useState(false);
  const [messages, setMessages] = useState([
    {
      id: 1,
      text: "Hi! I'm your intelligent AI assistant. I provide specific, actionable advice on programming, career guidance, and technical topics. Ask me anything and I'll give you detailed, practical suggestions!",
      sender: 'bot',
      timestamp: new Date()
    }
  ]);
  const [inputText, setInputText] = useState('');
  const [isTyping, setIsTyping] = useState(false);
  const [streamingMessage, setStreamingMessage] = useState('');
  const [conversationHistory, setConversationHistory] = useState([]);
  const messagesEndRef = useRef(null);

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages, streamingMessage]);

  // Intelligent AI response with comprehensive knowledge
  const getIntelligentResponse = async (userMessage) => {
    setIsTyping(true);
    setStreamingMessage('');
    const startTime = Date.now();
    
    try {
      const GEMINI_API_KEY = import.meta.env.VITE_GEMINI_API_KEY;
      
      if (!GEMINI_API_KEY || GEMINI_API_KEY === 'PASTE_YOUR_NEW_API_KEY_HERE') {
        throw new Error('API key not configured');
      }

      // Build conversation context
      const recentMessages = messages.slice(-6).map(msg => 
        `${msg.sender === 'user' ? 'Human' : 'Assistant'}: ${msg.text}`
      ).join('\n');
      
      const expertPrompt = `You are an expert AI assistant with comprehensive knowledge. Provide detailed, specific, and actionable responses.

CONVERSATION HISTORY:
${recentMessages}

INSTRUCTIONS:
- Give specific, practical advice with actionable steps
- Include current trends, best practices, and real-world examples
- Provide links, resources, and concrete recommendations
- Be comprehensive yet easy to understand
- Focus on helping the user make informed decisions
- Use bullet points and clear structure for readability

USER QUESTION: "${userMessage}"

Provide a detailed, expert-level response with specific recommendations and actionable advice:`;

      const requestBody = {
        contents: [{
          parts: [{ text: expertPrompt }]
        }],
        generationConfig: {
          temperature: 0.8,
          topK: 40,
          topP: 0.9,
          maxOutputTokens: 1500
        }
      };

      const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(requestBody)
      });
      
      if (!response.ok) {
        throw new Error(`API failed: ${response.status}`);
      }

      const data = await response.json();
      
      if (data.candidates?.[0]?.content?.parts?.[0]?.text) {
        let aiText = data.candidates[0].content.parts[0].text;
        
        setIsTyping(false);
        await simulateStreaming(aiText);
        
        setConversationHistory(prev => [...prev, 
          { role: 'user', content: userMessage },
          { role: 'assistant', content: aiText }
        ]);
        
        const responseTime = Date.now() - startTime;
        trackChatbotUsed(userMessage, responseTime);
        
        return aiText;
      } else {
        throw new Error('Invalid response structure');
      }
      
    } catch (error) {
      console.error('AI Error:', error.message);
      setIsTyping(false);
      
      const fallback = getExpertFallback(userMessage);
      await simulateStreaming(fallback);
      return fallback;
    }
  };

  // Simulate streaming
  const simulateStreaming = async (text) => {
    const words = text.split(' ');
    setStreamingMessage('');
    
    for (let i = 0; i < words.length; i++) {
      await new Promise(resolve => setTimeout(resolve, 50));
      setStreamingMessage(words.slice(0, i + 1).join(' '));
    }
    setStreamingMessage('');
  };

  // Expert fallback responses with specific advice
  const getExpertFallback = (userMessage) => {
    const msg = userMessage.toLowerCase();
    
    // Language choice for DSA
    if (msg.includes('python or c++') || msg.includes('which language') || (msg.includes('language') && msg.includes('dsa'))) {
      return `**üéØ For BTech 3rd Year: Python vs C++ for DSA**

**üêç PYTHON - RECOMMENDED CHOICE:**

**Why Python First:**
‚Ä¢ **Faster Learning** - Focus on logic, not syntax
‚Ä¢ **Interview Friendly** - 90% companies allow Python
‚Ä¢ **Built-in Data Structures** - Lists, dicts, sets ready to use
‚Ä¢ **Readable Code** - Easier to debug and understand
‚Ä¢ **Rapid Development** - Code 3x faster than C++

**‚ö° C++ Advantages:**
‚Ä¢ **Performance** - 10-50x faster execution
‚Ä¢ **Memory Control** - Better understanding of pointers
‚Ä¢ **Competitive Programming** - Standard for contests
‚Ä¢ **Industry Preference** - Some companies prefer C++

**üéØ MY RECOMMENDATION:**
**Start with Python** ‚Üí Master concepts ‚Üí **Switch to C++** if needed

**üìÖ Learning Timeline:**
‚Ä¢ **Month 1-2:** Python + Basic DSA (Arrays, Strings)
‚Ä¢ **Month 3-4:** Advanced DSA in Python (Trees, Graphs)
‚Ä¢ **Month 5+:** C++ for competitive programming (optional)

**üî• Why This Works:**
1. **Concept Clarity** - Python helps you understand algorithms faster
2. **Interview Success** - Most companies accept Python solutions
3. **Time Efficiency** - Learn DSA concepts in half the time

**üìö Resources:**
‚Ä¢ **Python DSA:** GeeksforGeeks Python section
‚Ä¢ **Practice:** LeetCode (Python solutions)
‚Ä¢ **Books:** "Python Algorithms" by Magnus Lie Hetland

**Bottom Line:** Python gets you job-ready faster. C++ is for optimization later.

Want a specific Python DSA learning roadmap?`;
    }

    // LeetCode and coding platforms
    if (msg.includes('leetcode') || msg.includes('coding platform') || msg.includes('practice') || msg.includes('site')) {
      return `**üöÄ Complete Coding Practice Platform Guide**

**üèÜ TOP PLATFORMS RANKED:**

**1. LeetCode** - https://leetcode.com/
‚Ä¢ **Best For:** Interview preparation (FAANG focus)
‚Ä¢ **Problems:** 2500+ with company tags
‚Ä¢ **Features:** Mock interviews, discuss section
‚Ä¢ **Cost:** Free (Premium $35/month)
‚Ä¢ **Must-Do:** Top 100 Liked Questions

**2. GeeksforGeeks** - https://geeksforgeeks.org/
‚Ä¢ **Best For:** Concept learning + practice
‚Ä¢ **Strength:** Detailed explanations with code
‚Ä¢ **Free:** All content available
‚Ä¢ **Perfect For:** Understanding theory first

**3. HackerRank** - https://hackerrank.com/
‚Ä¢ **Best For:** Beginners, skill assessment
‚Ä¢ **Features:** Certificates, company challenges
‚Ä¢ **Good For:** Building confidence initially

**4. CodeChef** - https://codechef.com/
‚Ä¢ **Best For:** Competitive programming
‚Ä¢ **Contests:** Monthly long/short contests
‚Ä¢ **Community:** Strong Indian developer base

**5. Codeforces** - https://codeforces.com/
‚Ä¢ **Best For:** Advanced competitive programming
‚Ä¢ **Rating System:** Track your progress
‚Ä¢ **Difficulty:** Higher than other platforms

**üéØ RECOMMENDED STRATEGY:**

**Phase 1 (Month 1-2): Foundation**
‚Ä¢ **GeeksforGeeks:** Learn concepts
‚Ä¢ **LeetCode Easy:** 50 problems
‚Ä¢ **Focus:** Arrays, Strings, Basic Math

**Phase 2 (Month 3-4): Building Skills**
‚Ä¢ **LeetCode Medium:** 100 problems
‚Ä¢ **HackerRank:** Data structures track
‚Ä¢ **Focus:** Trees, Graphs, DP basics

**Phase 3 (Month 5-6): Interview Ready**
‚Ä¢ **LeetCode:** Company-specific problems
‚Ä¢ **Mock Interviews:** Pramp, InterviewBit
‚Ä¢ **Target:** 300+ total problems solved

**üì± Mobile Apps:**
‚Ä¢ **LeetCode Mobile** - Practice anywhere
‚Ä¢ **GeeksforGeeks App** - Quick concept review

**üí° PRO TIPS:**
‚Ä¢ **Start with Easy** - Build confidence first
‚Ä¢ **Time Yourself** - Practice under pressure
‚Ä¢ **Review Solutions** - Learn multiple approaches
‚Ä¢ **Join Communities** - LeetCode discuss, Reddit

**üéØ For Placements:** Focus 80% on LeetCode, 20% on GeeksforGeeks

Ready to start? Which platform should we begin with?`;
    }

    // DSA learning path
    if (msg.includes('dsa') || msg.includes('data structures') || msg.includes('algorithms')) {
      return `**üéØ Complete DSA Mastery Roadmap (BTech 3rd Year)**

**üìÖ 6-MONTH STRATEGIC PLAN:**

**MONTH 1-2: FOUNDATIONS** üèóÔ∏è
**Week 1-2: Arrays & Strings**
‚Ä¢ Basic operations, two pointers, sliding window
‚Ä¢ **Practice:** 30 LeetCode easy problems
‚Ä¢ **Key Topics:** Sorting, searching, string manipulation

**Week 3-4: Mathematics & Bit Manipulation**
‚Ä¢ GCD, LCM, prime numbers, bit operations
‚Ä¢ **Practice:** 20 problems on number theory
‚Ä¢ **Applications:** Optimization tricks, fast calculations

**MONTH 3-4: CORE STRUCTURES** üå≥
**Week 5-6: Linked Lists & Stacks/Queues**
‚Ä¢ Single/double linked lists, stack applications
‚Ä¢ **Practice:** 40 medium problems
‚Ä¢ **Focus:** Pointer manipulation, LIFO/FIFO concepts

**Week 7-8: Trees & Binary Search Trees**
‚Ä¢ Binary trees, BST operations, tree traversals
‚Ä¢ **Practice:** 50 tree problems
‚Ä¢ **Master:** DFS, BFS, tree construction

**MONTH 5-6: ADVANCED TOPICS** üöÄ
**Week 9-10: Graphs & Advanced Trees**
‚Ä¢ Graph representations, BFS/DFS, shortest paths
‚Ä¢ **Practice:** 40 graph problems
‚Ä¢ **Include:** Dijkstra, Union-Find, Topological sort

**Week 11-12: Dynamic Programming & Greedy**
‚Ä¢ DP patterns, memoization, greedy strategies
‚Ä¢ **Practice:** 60 DP problems
‚Ä¢ **Master:** Knapsack, LIS, matrix DP

**üìä PROBLEM DISTRIBUTION:**
‚Ä¢ **Easy:** 100 problems (confidence building)
‚Ä¢ **Medium:** 150 problems (interview level)
‚Ä¢ **Hard:** 50 problems (competitive edge)
‚Ä¢ **Total:** 300+ problems

**üéØ DAILY SCHEDULE:**
‚Ä¢ **Morning (1 hour):** Learn new concept
‚Ä¢ **Evening (1.5 hours):** Solve 2-3 problems
‚Ä¢ **Weekend:** Review and practice contests

**üìö BEST RESOURCES:**

**Learning:**
‚Ä¢ **YouTube:** Striver's A2Z DSA Course
‚Ä¢ **Books:** "Introduction to Algorithms" (CLRS)
‚Ä¢ **Website:** GeeksforGeeks for concepts

**Practice:**
‚Ä¢ **Primary:** LeetCode (interview focus)
‚Ä¢ **Secondary:** GeeksforGeeks (concept reinforcement)
‚Ä¢ **Contests:** CodeChef, Codeforces (weekends)

**üèÜ MILESTONE TRACKING:**
‚Ä¢ **Month 2:** Solve 50 easy problems
‚Ä¢ **Month 4:** Solve 100 medium problems
‚Ä¢ **Month 6:** Complete 300+ total problems

**üíº WHY THIS MATTERS:**
‚Ä¢ **Placements:** 95% companies test DSA
‚Ä¢ **Salary Impact:** Good DSA = 2-3x higher packages
‚Ä¢ **Problem Solving:** Develops logical thinking
‚Ä¢ **Confidence:** Handle any coding challenge

**üéØ SUCCESS METRICS:**
‚Ä¢ Solve any medium problem in 30 minutes
‚Ä¢ Explain time/space complexity clearly
‚Ä¢ Code without syntax errors
‚Ä¢ Handle edge cases automatically

Ready to start? Which topic should we tackle first - Arrays or want a specific daily plan?`;
    }

    // Career and placement guidance
    if (msg.includes('placement') || msg.includes('job') || msg.includes('career') || msg.includes('interview')) {
      return `**üöÄ Complete BTech Placement Strategy (2024-25)**

**üìä CURRENT MARKET REALITY:**

**Package Ranges (Freshers):**
‚Ä¢ **Service Companies:** 3-7 LPA (TCS, Infosys, Wipro)
‚Ä¢ **Product Companies:** 8-15 LPA (Flipkart, Paytm, Zomato)
‚Ä¢ **FAANG/Tier-1:** 15-45 LPA (Google, Microsoft, Amazon)
‚Ä¢ **Startups:** 6-20 LPA (varies widely)

**üéØ 6-MONTH PLACEMENT ROADMAP:**

**PHASE 1 (Month 1-2): FOUNDATION**
**Technical Skills (70% time):**
‚Ä¢ **DSA:** 100 LeetCode problems (Easy‚ÜíMedium)
‚Ä¢ **Development:** Choose one stack (MERN/Django/Spring)
‚Ä¢ **CS Fundamentals:** OS, DBMS, Networks basics

**Soft Skills (30% time):**
‚Ä¢ **Communication:** Practice explaining technical concepts
‚Ä¢ **Resume Building:** 2-3 strong projects
‚Ä¢ **Aptitude:** Quantitative, logical reasoning

**PHASE 2 (Month 3-4): SKILL BUILDING**
**Advanced Technical:**
‚Ä¢ **DSA:** 200+ problems, focus on medium difficulty
‚Ä¢ **Projects:** 2 full-stack applications with deployment
‚Ä¢ **System Design:** Basics (for senior developer roles)

**Interview Preparation:**
‚Ä¢ **Mock Interviews:** Practice with peers/online platforms
‚Ä¢ **Behavioral Questions:** STAR method preparation
‚Ä¢ **Company Research:** Target company preparation

**PHASE 3 (Month 5-6): INTERVIEW SEASON**
**Final Preparation:**
‚Ä¢ **DSA:** 300+ problems, quick revision
‚Ä¢ **Projects:** Polish and prepare detailed explanations
‚Ä¢ **Mock Interviews:** Daily practice sessions

**Application Strategy:**
‚Ä¢ **Mass Applications:** Apply to 50+ companies
‚Ä¢ **Targeted Applications:** 10-15 dream companies
‚Ä¢ **Backup Plans:** Multiple offer strategies

**üè¢ COMPANY-WISE STRATEGY:**

**FAANG/Product Companies:**
**Requirements:**
‚Ä¢ 400+ DSA problems solved
‚Ä¢ Strong system design knowledge
‚Ä¢ 2-3 impressive projects with scale
‚Ä¢ Open source contributions (bonus)

**Preparation Timeline:** 8-12 months
**Success Rate:** 5-10% (high competition)
**Package:** 15-45 LPA

**Service Companies (Mass Recruiters):**
**Requirements:**
‚Ä¢ 150+ DSA problems
‚Ä¢ Basic development skills
‚Ä¢ Good communication
‚Ä¢ Strong aptitude scores

**Preparation Timeline:** 4-6 months
**Success Rate:** 60-80%
**Package:** 3-7 LPA

**Mid-Tier Product Companies:**
**Requirements:**
‚Ä¢ 250+ DSA problems
‚Ä¢ 2-3 solid projects
‚Ä¢ Good problem-solving skills
‚Ä¢ Domain knowledge (optional)

**Preparation Timeline:** 6-8 months
**Success Rate:** 20-30%
**Package:** 8-15 LPA

**üìö ESSENTIAL RESOURCES:**

**DSA Practice:**
‚Ä¢ **Primary:** LeetCode (interview focus)
‚Ä¢ **Theory:** GeeksforGeeks
‚Ä¢ **Books:** Cracking the Coding Interview

**Development:**
‚Ä¢ **Web Dev:** FreeCodeCamp, The Odin Project
‚Ä¢ **Backend:** Official documentation
‚Ä¢ **Projects:** Build real-world applications

**Interview Prep:**
‚Ä¢ **Mock Interviews:** Pramp, InterviewBit
‚Ä¢ **Behavioral:** Glassdoor company reviews
‚Ä¢ **Aptitude:** IndiaBix, PrepInsta

**üéØ SUCCESS METRICS:**

**Technical Readiness:**
‚Ä¢ Solve medium DSA problems in 25-30 minutes
‚Ä¢ Explain projects confidently for 15+ minutes
‚Ä¢ Code without major syntax errors
‚Ä¢ Handle system design basics

**Soft Skills Readiness:**
‚Ä¢ Clear communication in English
‚Ä¢ Confident body language
‚Ä¢ Good problem-solving approach
‚Ä¢ Team collaboration examples

**üìà MONTHLY TARGETS:**
‚Ä¢ **Month 1:** 50 DSA problems + 1 project
‚Ä¢ **Month 2:** 100 DSA problems + 1 project
‚Ä¢ **Month 3:** 150 DSA problems + resume ready
‚Ä¢ **Month 4:** 200 DSA problems + mock interviews
‚Ä¢ **Month 5:** 250+ problems + applications
‚Ä¢ **Month 6:** Interview season + offers

**üí° PRO TIPS:**
‚Ä¢ **Start Early:** Don't wait for placement season
‚Ä¢ **Consistency:** Daily practice beats weekend marathons
‚Ä¢ **Network:** Connect with seniors and alumni
‚Ä¢ **Multiple Offers:** Never rely on single company
‚Ä¢ **Backup Plans:** Keep options open

**üéØ IMMEDIATE ACTION PLAN:**
1. **Today:** Start with 2 easy DSA problems
2. **This Week:** Choose your tech stack
3. **This Month:** Complete 20 problems + start project
4. **Next Month:** Increase to 50 problems + finish project

Which area needs immediate focus - DSA, projects, or interview skills? I can create a detailed weekly plan for you!`;
    }

    // Default intelligent response
    return `I'm here to provide you with specific, actionable advice! Based on your question, I can help you with:

**üéØ Technical Guidance:**
‚Ä¢ Programming language recommendations with reasons
‚Ä¢ Detailed learning roadmaps with timelines
‚Ä¢ Best resources and platforms for practice
‚Ä¢ Project ideas and implementation strategies

**üíº Career Planning:**
‚Ä¢ Placement preparation strategies
‚Ä¢ Company-specific interview tips
‚Ä¢ Skill development priorities
‚Ä¢ Market trends and salary insights

**üìö Learning Support:**
‚Ä¢ Concept explanations with examples
‚Ä¢ Problem-solving approaches
‚Ä¢ Study schedules and milestones
‚Ä¢ Resource recommendations

**üî• What I Provide:**
‚Ä¢ **Specific recommendations** (not generic advice)
‚Ä¢ **Actionable steps** you can start today
‚Ä¢ **Current market insights** and trends
‚Ä¢ **Detailed explanations** with examples
‚Ä¢ **Resource links** and platform suggestions

Could you be more specific about what you'd like to know? For example:
- "Python or C++ for DSA learning?"
- "Best coding practice platforms for placements"
- "Complete roadmap for software developer role"
- "How to prepare for technical interviews"

I'll give you detailed, practical advice that you can implement immediately!`;
  };

  const handleSendMessage = async () => {
    if (!inputText.trim()) return;

    const userMessage = {
      id: messages.length + 1,
      text: inputText,
      sender: 'user',
      timestamp: new Date()
    };

    setMessages(prev => [...prev, userMessage]);
    const currentInput = inputText;
    setInputText('');

    const aiResponse = await getIntelligentResponse(currentInput);
    
    const botMessage = {
      id: messages.length + 2,
      text: aiResponse,
      sender: 'bot',
      timestamp: new Date()
    };

    setMessages(prev => [...prev, botMessage]);
  };

  const handleKeyPress = (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSendMessage();
    }
  };

  const clearConversation = () => {
    setMessages([{
      id: 1,
      text: "Hi! I'm your intelligent AI assistant. I provide specific, actionable advice on programming, career guidance, and technical topics. Ask me anything and I'll give you detailed, practical suggestions!",
      sender: 'bot',
      timestamp: new Date()
    }]);
    setConversationHistory([]);
  };

  const smartPrompts = [
    "Python or C++ for DSA? I'm BTech 3rd year",
    "Best coding practice websites like LeetCode",
    "Complete placement preparation strategy",
    "How to master data structures quickly?",
    "Which programming language should I learn first?",
    "Best resources for competitive programming"
  ];

  return (
    <>
      {/* Chat Toggle Button */}
      <div className="fixed bottom-6 right-6 z-50">
        <button
          onClick={() => setIsOpen(!isOpen)}
          className="w-16 h-16 bg-gradient-to-r from-purple-600 via-blue-600 to-indigo-600 text-white rounded-full shadow-2xl hover:shadow-3xl hover:scale-110 transition-all duration-300 flex items-center justify-center group relative overflow-hidden"
        >
          <div className="absolute inset-0 bg-gradient-to-r from-purple-400 to-indigo-400 opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
          {isOpen ? (
            <svg className="w-8 h-8 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
          ) : (
            <svg className="w-8 h-8 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
            </svg>
          )}
        </button>
        
        <div className="absolute -top-2 -right-2 w-6 h-6 bg-gradient-to-r from-green-400 to-blue-500 text-white text-xs rounded-full flex items-center justify-center animate-pulse font-bold">
          üí°
        </div>
      </div>

      {/* Intelligent Chat Window */}
      {isOpen && (
        <div className="fixed bottom-24 right-6 w-[480px] h-[700px] bg-white rounded-3xl shadow-2xl z-40 flex flex-col overflow-hidden border border-gray-200">
          {/* Header */}
          <div className="bg-gradient-to-r from-purple-600 via-blue-600 to-indigo-600 text-white p-5 flex items-center justify-between relative overflow-hidden">
            <div className="absolute inset-0 bg-gradient-to-r from-purple-400 to-indigo-400 opacity-20"></div>
            <div className="flex items-center gap-3 relative z-10">
              <div className="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm">
                <span className="text-xl">üí°</span>
              </div>
              <div>
                <h3 className="font-bold text-lg">IntelliGPT</h3>
                <p className="text-xs text-purple-100">Smart AI with expert advice</p>
              </div>
            </div>
            <div className="flex items-center gap-2 relative z-10">
              <button
                onClick={clearConversation}
                className="text-white/80 hover:text-white p-2 rounded-lg hover:bg-white/10 transition-colors"
                title="New conversation"
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                </svg>
              </button>
              <button
                onClick={() => setIsOpen(false)}
                className="text-white/80 hover:text-white p-1 rounded-lg hover:bg-white/10 transition-colors"
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
          </div>

          {/* Messages Area */}
          <div className="flex-1 overflow-y-auto p-5 space-y-4 bg-gradient-to-b from-gray-50 to-white">
            {messages.map((message) => (
              <div
                key={message.id}
                className={`flex ${message.sender === 'user' ? 'justify-end' : 'justify-start'}`}
              >
                <div
                  className={`max-w-[85%] p-4 rounded-2xl ${
                    message.sender === 'user'
                      ? 'bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg'
                      : 'bg-white text-gray-800 shadow-md border border-gray-100'
                  }`}
                >
                  <p className="text-sm whitespace-pre-line leading-relaxed">{message.text}</p>
                  <p className="text-xs mt-2 opacity-70">
                    {message.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                  </p>
                </div>
              </div>
            ))}
            
            {/* Streaming Message */}
            {streamingMessage && (
              <div className="flex justify-start">
                <div className="max-w-[85%] p-4 rounded-2xl bg-white text-gray-800 shadow-md border border-gray-100">
                  <p className="text-sm whitespace-pre-line leading-relaxed">
                    {streamingMessage}
                    <span className="inline-block w-2 h-5 bg-blue-500 ml-1 animate-pulse"></span>
                  </p>
                </div>
              </div>
            )}
            
            {/* Typing Indicator */}
            {isTyping && !streamingMessage && (
              <div className="flex justify-start">
                <div className="bg-white p-4 rounded-2xl shadow-md border border-gray-100">
                  <div className="flex items-center space-x-2">
                    <div className="flex space-x-1">
                      <div className="w-2 h-2 bg-purple-500 rounded-full animate-bounce"></div>
                      <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style={{ animationDelay: '0.1s' }}></div>
                      <div className="w-2 h-2 bg-indigo-500 rounded-full animate-bounce" style={{ animationDelay: '0.2s' }}></div>
                    </div>
                    <span className="text-xs text-gray-500">üí° Thinking of the best advice...</span>
                  </div>
                </div>
              </div>
            )}
            
            <div ref={messagesEndRef} />
          </div>

          {/* Smart Prompts */}
          {messages.length <= 1 && (
            <div className="p-5 border-t bg-gradient-to-r from-gray-50 to-white">
              <p className="text-xs text-gray-600 mb-3 font-semibold">üí° Ask me for specific advice:</p>
              <div className="grid grid-cols-1 gap-2">
                {smartPrompts.slice(0, 3).map((prompt, index) => (
                  <button
                    key={index}
                    onClick={() => setInputText(prompt)}
                    className="text-left text-xs bg-gradient-to-r from-purple-50 to-blue-50 p-3 rounded-xl hover:from-purple-100 hover:to-blue-100 transition-all duration-200 border border-purple-200 hover:border-blue-300 hover:shadow-md"
                  >
                    {prompt}
                  </button>
                ))}
              </div>
            </div>
          )}

          {/* Input Area */}
          <div className="p-5 border-t bg-white">
            <div className="flex gap-3 items-end">
              <div className="flex-1 relative">
                <textarea
                  value={inputText}
                  onChange={(e) => setInputText(e.target.value)}
                  onKeyPress={handleKeyPress}
                  placeholder="Ask for specific advice - I'll give detailed suggestions!"
                  className="w-full px-4 py-3 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm resize-none max-h-24 min-h-[48px]"
                  disabled={isTyping}
                  rows={1}
                />
              </div>
              <button
                onClick={handleSendMessage}
                disabled={!inputText.trim() || isTyping}
                className="w-12 h-12 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-2xl hover:from-purple-700 hover:to-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl"
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                </svg>
              </button>
            </div>
          </div>
        </div>
      )}
    </>
  );
}
import React, { useState, useRef, useEffect } from 'react';
import { auth, db } from '../firebase';
import { doc, getDoc } from 'firebase/firestore';
import { trackChatbotUsed } from '../utils/analytics';

export default function MentorChatbot() {
  const [isOpen, setIsOpen] = useState(false);
  const [messages, setMessages] = useState([
    {
      id: 1,
      text: "Hi! I'm your AI Career Mentor ü§ñ I'm here to help you succeed in your engineering journey!\n\nFeel free to ask me about:\n‚Ä¢ Programming & DSA tips\n‚Ä¢ Career guidance & job hunting\n‚Ä¢ Project ideas & building cool stuff\n‚Ä¢ Interview prep & confidence building\n\nWhat's on your mind today? üòä",
      sender: 'bot',
      timestamp: new Date()
    }
  ]);
  const [inputText, setInputText] = useState('');
  const [isTyping, setIsTyping] = useState(false);
  const [streamingMessage, setStreamingMessage] = useState('');
  const [userContext, setUserContext] = useState({
    name: '',
    year: '',
    mood: '',
    timeAvailable: '',
    lastTopic: ''
  });
  const messagesEndRef = useRef(null);

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  // Get user context from Firebase
  useEffect(() => {
    const loadUserContext = async () => {
      const user = auth.currentUser;
      if (user) {
        try {
          const userDoc = await getDoc(doc(db, 'users', user.uid));
          if (userDoc.exists()) {
            const userData = userDoc.data();
            setUserContext(prev => ({
              ...prev,
              name: userData.name || '',
              year: userData.year || ''
            }));
          }
        } catch (error) {
          console.log('Context load error:', error);
        }
      }
    };
    loadUserContext();
  }, []);

  // Real-time AI responses with streaming
  const getAIResponse = async (userMessage) => {
    setIsTyping(true);
    setStreamingMessage('');
    const startTime = Date.now();
    
    try {
      const GEMINI_API_KEY = import.meta.env.VITE_GEMINI_API_KEY;
      
      if (!GEMINI_API_KEY) {
        throw new Error('API key not found');
      }

      const requestBody = {
        contents: [{
          parts: [{
            text: `You are Alex, a friendly AI career mentor who's helped thousands of engineering students. You're encouraging, use casual language, and share personal insights. Respond naturally like you're chatting with a friend about: ${userMessage}

Guidelines:
- Use "I", "you", "we" - be personal
- Share encouraging words
- Use casual phrases like "Hey!", "Great question!", "I totally get it"
- Include relatable examples
- Keep it conversational and warm
- Max 120 words`
          }]
        }],
        generationConfig: {
          temperature: 0.8,
          topK: 40,
          topP: 0.9,
          maxOutputTokens: 200
        }
      };

      const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(requestBody)
      });
      
      if (!response.ok) {
        throw new Error(`API failed: ${response.status}`);
      }

      const data = await response.json();
      
      if (data.candidates?.[0]?.content?.parts?.[0]?.text) {
        const aiText = data.candidates[0].content.parts[0].text;
        
        // Simulate streaming effect for better UX
        setIsTyping(false);
        await simulateStreaming(aiText);
        
        const responseTime = Date.now() - startTime;
        trackChatbotUsed(userMessage, responseTime);
        
        return aiText;
      } else {
        throw new Error('Invalid response');
      }
      
    } catch (error) {
      console.error('AI Error:', error);
      setIsTyping(false);
      
      // Fast fallback responses
      const fallback = getFastFallback(userMessage);
      await simulateStreaming(fallback);
      return fallback;
    }
  };

  // Simulate streaming for better UX
  const simulateStreaming = async (text) => {
    const words = text.split(' ');
    setStreamingMessage('');
    
    for (let i = 0; i < words.length; i++) {
      await new Promise(resolve => setTimeout(resolve, 30)); // 30ms per word
      setStreamingMessage(words.slice(0, i + 1).join(' '));
    }
    setStreamingMessage('');
  };

  // Human-like fallback responses
  const getFastFallback = (userMessage) => {
    const msg = userMessage.toLowerCase();
    
    if (msg.includes('algorithm') || msg.includes('dsa')) {
      return "Hey! üòä DSA can feel overwhelming at first - I totally get it! Here's what worked for me and thousands of students:\n\n‚Ä¢ Start small with arrays & strings (trust me on this!)\n‚Ä¢ Practice just 2 problems daily - consistency beats intensity\n‚Ä¢ Focus on patterns like two pointers - they're game changers!\n\nYou've got this! üí™ LeetCode and GeeksforGeeks are your best friends here.";
    }
    if (msg.includes('career') || msg.includes('job') || msg.includes('interview')) {
      return "Great question! üöÄ I've seen so many students land amazing jobs by following this path:\n\n‚Ä¢ Master 300+ DSA problems (sounds scary but totally doable!)\n‚Ä¢ Build 3-4 projects you're genuinely proud of\n‚Ä¢ Learn system design basics (super important for senior roles)\n‚Ä¢ Practice mock interviews - seriously, this is a game changer!\n\nRemember, every expert was once a beginner. You're on the right track! üòä";
    }
    if (msg.includes('project')) {
      return "Love this question! üí° Projects are where the magic happens. Here's what I recommend:\n\n**Starting out?** Try a calculator or todo app - they teach fundamentals\n**Getting confident?** Build a chat app or blog - users love these!\n**Ready to impress?** Go for e-commerce or social media clone\n\nPro tip: Deploy everything on Vercel or Netlify. Recruiters love seeing live projects! ‚ú®";
    }
    if (msg.includes('resume')) {
      return "Ah, the resume! üìÑ I've reviewed thousands, and here's what makes them shine:\n\n‚Ä¢ Keep it 1-2 pages max (recruiters have short attention spans!)\n‚Ä¢ Lead with your best projects and skills\n‚Ä¢ Use clean, ATS-friendly format (fancy designs often backfire)\n‚Ä¢ Always include GitHub links - show your code!\n\nRemember, your resume is your story. Make it compelling! üåü";
    }
    if (msg.includes('stress') || msg.includes('overwhelm') || msg.includes('difficult')) {
      return "I hear you! ü§ó Learning can feel overwhelming sometimes - that's totally normal and shows you care about growing!\n\nTake a deep breath. Break things into smaller chunks. Celebrate small wins. And remember - every coding expert started exactly where you are now.\n\nYou're not behind, you're not slow. You're learning, and that's amazing! üíô";
    }
    
    return "Hey there! üëã I'm Alex, your friendly AI mentor! I'm here to help you navigate your engineering journey.\n\nI love chatting about:\n‚Ä¢ DSA & coding challenges\n‚Ä¢ Career advice & job hunting\n‚Ä¢ Project ideas & building cool stuff\n‚Ä¢ Interview prep & confidence building\n\nWhat's on your mind today? I'm all ears! üòä";
  };

  const handleSendMessage = async () => {
    if (!inputText.trim()) return;

    const userMessage = {
      id: messages.length + 1,
      text: inputText,
      sender: 'user',
      timestamp: new Date()
    };

    setMessages(prev => [...prev, userMessage]);
    setInputText('');

    // Get AI response
    const aiResponse = await getAIResponse(inputText);
    
    const botMessage = {
      id: messages.length + 2,
      text: aiResponse,
      sender: 'bot',
      timestamp: new Date()
    };

    setMessages(prev => [...prev, botMessage]);
  };

  const handleKeyPress = (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSendMessage();
    }
  };

  const quickQuestions = [
    "How do I start with DSA?",
    "I'm feeling overwhelmed, help!",
    "What projects should I build?",
    "How to ace interviews?"
  ];

  return (
    <>
      {/* Chat Toggle Button */}
      <div className="fixed bottom-6 right-6 z-50">
        <button
          onClick={() => setIsOpen(!isOpen)}
          className="w-16 h-16 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-full shadow-2xl hover:shadow-3xl hover:scale-110 transition-all duration-300 flex items-center justify-center"
        >
          {isOpen ? (
            <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
          ) : (
            <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
            </svg>
          )}
        </button>
        
        {/* Notification Badge */}
        <div className="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white text-xs rounded-full flex items-center justify-center animate-pulse">
          AI
        </div>
      </div>

      {/* Chat Window */}
      {isOpen && (
        <div className="fixed bottom-24 right-6 w-96 h-[500px] bg-white rounded-2xl shadow-2xl z-40 flex flex-col overflow-hidden border border-gray-200">
          {/* Header */}
          <div className="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                ü§ñ
              </div>
              <div>
                <h3 className="font-semibold">AI Career Mentor</h3>
                <p className="text-xs text-blue-100">Always here to help!</p>
              </div>
            </div>
            <button
              onClick={() => setIsOpen(false)}
              className="text-white/80 hover:text-white"
            >
              <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>

          {/* Messages */}
          <div className="flex-1 overflow-y-auto p-4 space-y-4">
            {messages.map((message) => (
              <div
                key={message.id}
                className={`flex ${message.sender === 'user' ? 'justify-end' : 'justify-start'}`}
              >
                <div
                  className={`max-w-[80%] p-3 rounded-2xl ${
                    message.sender === 'user'
                      ? 'bg-blue-600 text-white'
                      : 'bg-gray-100 text-gray-800'
                  }`}
                >
                  <p className="text-sm whitespace-pre-line">{message.text}</p>
                  <p className="text-xs mt-1 opacity-70">
                    {message.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                  </p>
                </div>
              </div>
            ))}
            
            {/* Streaming Message */}
            {streamingMessage && (
              <div className="flex justify-start">
                <div className="max-w-[80%] p-3 rounded-2xl bg-gray-100 text-gray-800">
                  <p className="text-sm whitespace-pre-line">{streamingMessage}</p>
                </div>
              </div>
            )}
            
            {/* Typing Indicator */}
            {isTyping && (
              <div className="flex justify-start">
                <div className="bg-gray-100 p-3 rounded-2xl">
                  <div className="flex space-x-1">
                    <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce"></div>
                    <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style={{ animationDelay: '0.1s' }}></div>
                    <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style={{ animationDelay: '0.2s' }}></div>
                  </div>
                </div>
              </div>
            )}
            
            <div ref={messagesEndRef} />
          </div>

          {/* Quick Questions */}
          {messages.length <= 1 && (
            <div className="p-4 border-t bg-gray-50">
              <p className="text-xs text-gray-600 mb-2">Quick questions:</p>
              <div className="space-y-2">
                {quickQuestions.map((question, index) => (
                  <button
                    key={index}
                    onClick={() => setInputText(question)}
                    className="w-full text-left text-xs bg-white p-2 rounded-lg hover:bg-blue-50 transition-colors border"
                  >
                    {question}
                  </button>
                ))}
              </div>
            </div>
          )}

          {/* Input */}
          <div className="p-4 border-t bg-white">
            <div className="flex gap-2">
              <input
                type="text"
                value={inputText}
                onChange={(e) => setInputText(e.target.value)}
                onKeyPress={handleKeyPress}
                placeholder="Ask me anything..."
                className="flex-1 px-4 py-2 border border-gray-300 rounded-full focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
              />
              <button
                onClick={handleSendMessage}
                disabled={!inputText.trim() || isTyping}
                className="w-10 h-10 bg-blue-600 text-white rounded-full hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                </svg>
              </button>
            </div>
          </div>
        </div>
      )}
    </>
  );
}
import React, { useState, useRef, useEffect } from 'react';
import { auth, db } from '../firebase';
import { doc, getDoc } from 'firebase/firestore';
import { trackChatbotUsed } from '../utils/analytics';

export default function MentorChatbot() {
  const [isOpen, setIsOpen] = useState(false);
  const [messages, setMessages] = useState([
    {
      id: 1,
      text: "Hi! I'm Alex, your personal AI mentor ü§ñ I understand emotions and create personalized study plans just for you!\n\nI'm here to help with:\n‚Ä¢ Emotional support during tough times\n‚Ä¢ Custom study schedules based on your time\n‚Ä¢ Breaking down complex concepts\n‚Ä¢ Career guidance with empathy\n\nHow are you feeling today? üòä",
      sender: 'bot',
      timestamp: new Date()
    }
  ]);
  const [inputText, setInputText] = useState('');
  const [isTyping, setIsTyping] = useState(false);
  const [streamingMessage, setStreamingMessage] = useState('');
  const [currentQuestion, setCurrentQuestion] = useState(0);
  const [answers, setAnswers] = useState([]);
  const [userContext, setUserContext] = useState({
    name: '',
    year: '',
    mood: '',
    timeAvailable: ''
  });
  const messagesEndRef = useRef(null);

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  // Load user context from Firebase
  useEffect(() => {
    const loadUserContext = async () => {
      const user = auth.currentUser;
      if (user) {
        try {
          const userDoc = await getDoc(doc(db, 'users', user.uid));
          if (userDoc.exists()) {
            const userData = userDoc.data();
            setUserContext(prev => ({
              ...prev,
              name: userData.name || '',
              year: userData.year || ''
            }));
          }
        } catch (error) {
          console.log('Context load error:', error);
        }
      }
    };
    loadUserContext();
  }, []);

  // Detect emotional state
  const detectMood = (message) => {
    const msg = message.toLowerCase();
    if (msg.includes('stress') || msg.includes('overwhelm') || msg.includes('anxious') || msg.includes('worried')) return 'stressed';
    if (msg.includes('confused') || msg.includes('lost') || msg.includes('don\'t understand')) return 'confused';
    if (msg.includes('excited') || msg.includes('motivated') || msg.includes('ready')) return 'motivated';
    if (msg.includes('tired') || msg.includes('exhausted') || msg.includes('burnout')) return 'tired';
    if (msg.includes('sad') || msg.includes('depressed') || msg.includes('down')) return 'sad';
    return 'neutral';
  };

  // Detect time availability
  const detectTimeAvailable = (message) => {
    const msg = message.toLowerCase();
    if (msg.includes('1 hour') || msg.includes('one hour')) return '1 hour';
    if (msg.includes('2 hour') || msg.includes('two hour')) return '2 hours';
    if (msg.includes('30 min') || msg.includes('half hour')) return '30 minutes';
    if (msg.includes('weekend') || msg.includes('saturday') || msg.includes('sunday')) return 'weekend';
    if (msg.includes('busy') || msg.includes('no time')) return 'very limited';
    return 'not specified';
  };

  // Enhanced AI responses with emotional intelligence
  const getAIResponse = async (userMessage) => {
    setIsTyping(true);
    setStreamingMessage('');
    const startTime = Date.now();
    
    try {
      const GEMINI_API_KEY = import.meta.env.VITE_GEMINI_API_KEY;
      
      if (!GEMINI_API_KEY) {
        throw new Error('API key not found');
      }

      const mood = detectMood(userMessage);
      const timeAvailable = detectTimeAvailable(userMessage);
      
      const simplePrompt = `You are Alex, a friendly AI mentor. Student asks: "${userMessage}". Give a helpful, encouraging response in under 100 words.`;

      const requestBody = {
        contents: [{
          parts: [{ text: contextualPrompt }]
        }],
        generationConfig: {
          temperature: 0.9,
          topK: 50,
          topP: 0.95,
          maxOutputTokens: 250
        }
      };

      const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{ parts: [{ text: simplePrompt }] }]
        })
      });
      
      if (!response.ok) {
        throw new Error(`API failed: ${response.status}`);
      }

      const data = await response.json();
      
      if (data.candidates?.[0]?.content?.parts?.[0]?.text) {
        const aiText = data.candidates[0].content.parts[0].text;
        
        setIsTyping(false);
        await simulateStreaming(aiText);
        
        const responseTime = Date.now() - startTime;
        trackChatbotUsed(userMessage, responseTime);
        
        return aiText;
      } else {
        throw new Error('Invalid response');
      }
      
    } catch (error) {
      console.error('AI Error:', error);
      setIsTyping(false);
      
      const fallback = getEmotionalFallback(userMessage);
      await simulateStreaming(fallback);
      return fallback;
    }
  };

  // Simulate streaming for better UX
  const simulateStreaming = async (text) => {
    const words = text.split(' ');
    setStreamingMessage('');
    
    for (let i = 0; i < words.length; i++) {
      await new Promise(resolve => setTimeout(resolve, 30));
      setStreamingMessage(words.slice(0, i + 1).join(' '));
    }
    setStreamingMessage('');
  };

  // Emotional fallback responses
  const getEmotionalFallback = (userMessage) => {
    const msg = userMessage.toLowerCase();
    const mood = detectMood(userMessage);
    const timeAvailable = detectTimeAvailable(userMessage);
    const name = userContext.name ? `, ${userContext.name}` : '';
    
    // Emotional responses first
    if (mood === 'stressed') {
      return `Hey${name} ü§ó I can sense you're feeling overwhelmed right now, and that's completely okay. Take a deep breath with me for a moment.

When I work with stressed students, here's what helps:
‚Ä¢ Break everything into tiny 15-minute chunks
‚Ä¢ Start with just ONE easy problem today
‚Ä¢ Remember: progress > perfection
‚Ä¢ You're not behind - you're exactly where you need to be

What's the biggest thing stressing you out right now? Let's tackle it together. üíô`;
    }
    
    if (mood === 'confused') {
      return `I hear the confusion in your message${name}, and honestly? That means you're learning! üå±

Confusion is just your brain making new connections. Here's how we'll clear the fog:
‚Ä¢ Let's identify the EXACT concept that's tricky
‚Ä¢ I'll break it down into bite-sized pieces
‚Ä¢ We'll find 3 different ways to understand it
‚Ä¢ Practice with super simple examples first

What specific topic has you scratching your head? I'm here to untangle it with you! üß©`;
    }
    
    if (mood === 'tired') {
      return `Oh${name}, I can feel the exhaustion in your words üò¥ Your brain needs rest to absorb all that learning!

When you're this tired:
‚Ä¢ 20-minute study sessions MAX
‚Ä¢ Focus on review, not new concepts
‚Ä¢ Try the Pomodoro technique
‚Ä¢ Sleep is NOT optional - it's when learning happens

How many hours did you sleep last night? Sometimes the best study plan is a good nap first! üí§`;
    }
    
    // Study plan requests
    if (msg.includes('study plan') || msg.includes('schedule')) {
      let plan = `Perfect${name}! Let me create a personalized study plan for you üìÖ

`;
      
      if (timeAvailable === '1 hour') {
        plan += `**Your 1-Hour Daily Plan:**
‚Ä¢ 20 min: Review previous concepts
‚Ä¢ 30 min: Learn 1 new topic
‚Ä¢ 10 min: Practice problems

This is actually perfect - focused learning beats marathon sessions!`;
      } else if (timeAvailable === '2 hours') {
        plan += `**Your 2-Hour Power Plan:**
‚Ä¢ 45 min: Deep dive into 1 major topic
‚Ä¢ 15 min: Break (seriously, take it!)
‚Ä¢ 45 min: Practice problems
‚Ä¢ 15 min: Review and plan tomorrow`;
      } else if (timeAvailable === 'weekend') {
        plan += `**Weekend Warrior Plan:**
‚Ä¢ Saturday: 3 hours spread across morning/evening
‚Ä¢ Sunday: 2 hours + project work
‚Ä¢ Include fun coding projects - weekends should be enjoyable!`;
      } else {
        plan += `**Flexible Daily Plan:**
‚Ä¢ Morning: 30 min theory (fresh brain!)
‚Ä¢ Evening: 45 min practice
‚Ä¢ Before bed: 15 min review

How much time can you realistically dedicate daily?`;
      }
      
      return plan;
    }
    
    // DSA with emotional support
    if (msg.includes('algorithm') || msg.includes('dsa')) {
      return `${name}, DSA can feel like climbing Mount Everest at first - I've been there! üèîÔ∏è

Here's my proven approach for ${userContext.year || 'your'} year:
‚Ä¢ Week 1-2: Arrays & Strings (build confidence!)
‚Ä¢ Week 3-4: Linked Lists & Stacks
‚Ä¢ Week 5-6: Trees & Recursion
‚Ä¢ Celebrate EVERY small win

Feeling overwhelmed? Start with just 1 easy problem today. I believe in you! What's your biggest DSA fear right now? üí™`;
    }
    
    // Career guidance with empathy
    if (msg.includes('career') || msg.includes('job') || msg.includes('future')) {
      return `${name}, career anxiety is SO normal - every successful engineer felt this way! üåü

Your ${userContext.year || ''} year journey:
‚Ä¢ Focus on building 2-3 solid projects
‚Ä¢ Network with seniors (they want to help!)
‚Ä¢ Apply to internships even if you feel "not ready"
‚Ä¢ Remember: companies hire potential, not perfection

What's your dream company? Let's reverse-engineer the path there together! üöÄ`;
    }
    
    return `Hey there${name}! üëã I'm Alex, and I'm genuinely excited to help you succeed! 

I specialize in:
‚Ä¢ Creating personalized study plans
‚Ä¢ Emotional support during tough times
‚Ä¢ Breaking down complex concepts
‚Ä¢ Career guidance & confidence building

What's on your mind today? I'm here to listen and help! üòä`;
  };

  const handleSendMessage = async () => {
    if (!inputText.trim()) return;

    const userMessage = {
      id: messages.length + 1,
      text: inputText,
      sender: 'user',
      timestamp: new Date()
    };

    setMessages(prev => [...prev, userMessage]);
    setInputText('');

    const aiResponse = await getAIResponse(inputText);
    
    const botMessage = {
      id: messages.length + 2,
      text: aiResponse,
      sender: 'bot',
      timestamp: new Date()
    };

    setMessages(prev => [...prev, botMessage]);
  };

  const handleKeyPress = (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSendMessage();
    }
  };

  const quickQuestions = [
    "I'm feeling overwhelmed with studies",
    "Create a study plan for me",
    "I have 2 hours daily, help me",
    "I'm confused about my career path"
  ];

  return (
    <>
      {/* Chat Toggle Button */}
      <div className="fixed bottom-6 right-6 z-50">
        <button
          onClick={() => setIsOpen(!isOpen)}
          className="w-16 h-16 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-full shadow-2xl hover:shadow-3xl hover:scale-110 transition-all duration-300 flex items-center justify-center"
        >
          {isOpen ? (
            <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
          ) : (
            <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
            </svg>
          )}
        </button>
        
        <div className="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white text-xs rounded-full flex items-center justify-center animate-pulse">
          AI
        </div>
      </div>

      {/* Chat Window */}
      {isOpen && (
        <div className="fixed bottom-24 right-6 w-96 h-[500px] bg-white rounded-2xl shadow-2xl z-40 flex flex-col overflow-hidden border border-gray-200">
          {/* Header */}
          <div className="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                ü§ñ
              </div>
              <div>
                <h3 className="font-semibold">Alex - Your AI Mentor</h3>
                <p className="text-xs text-blue-100">Emotionally intelligent & caring!</p>
              </div>
            </div>
            <button
              onClick={() => setIsOpen(false)}
              className="text-white/80 hover:text-white"
            >
              <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>

          {/* Messages */}
          <div className="flex-1 overflow-y-auto p-4 space-y-4">
            {messages.map((message) => (
              <div
                key={message.id}
                className={`flex ${message.sender === 'user' ? 'justify-end' : 'justify-start'}`}
              >
                <div
                  className={`max-w-[80%] p-3 rounded-2xl ${
                    message.sender === 'user'
                      ? 'bg-blue-600 text-white'
                      : 'bg-gray-100 text-gray-800'
                  }`}
                >
                  <p className="text-sm whitespace-pre-line">{message.text}</p>
                  <p className="text-xs mt-1 opacity-70">
                    {message.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                  </p>
                </div>
              </div>
            ))}
            
            {/* Streaming Message */}
            {streamingMessage && (
              <div className="flex justify-start">
                <div className="max-w-[80%] p-3 rounded-2xl bg-gray-100 text-gray-800">
                  <p className="text-sm whitespace-pre-line">{streamingMessage}</p>
                </div>
              </div>
            )}
            
            {/* Typing Indicator */}
            {isTyping && (
              <div className="flex justify-start">
                <div className="bg-gray-100 p-3 rounded-2xl">
                  <div className="flex space-x-1">
                    <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce"></div>
                    <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style={{ animationDelay: '0.1s' }}></div>
                    <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style={{ animationDelay: '0.2s' }}></div>
                  </div>
                </div>
              </div>
            )}
            
            <div ref={messagesEndRef} />
          </div>

          {/* Quick Questions */}
          {messages.length <= 1 && (
            <div className="p-4 border-t bg-gray-50">
              <p className="text-xs text-gray-600 mb-2">Try asking:</p>
              <div className="space-y-2">
                {quickQuestions.map((question, index) => (
                  <button
                    key={index}
                    onClick={() => setInputText(question)}
                    className="w-full text-left text-xs bg-white p-2 rounded-lg hover:bg-blue-50 transition-colors border"
                  >
                    {question}
                  </button>
                ))}
              </div>
            </div>
          )}

          {/* Input */}
          <div className="p-4 border-t bg-white">
            <div className="flex gap-2">
              <input
                type="text"
                value={inputText}
                onChange={(e) => setInputText(e.target.value)}
                onKeyPress={handleKeyPress}
                placeholder="Share what's on your mind..."
                className="flex-1 px-4 py-2 border border-gray-300 rounded-full focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
              />
              <button
                onClick={handleSendMessage}
                disabled={!inputText.trim() || isTyping}
                className="w-10 h-10 bg-blue-600 text-white rounded-full hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                </svg>
              </button>
            </div>
          </div>
        </div>
      )}
    </>
  );
}
import React, { useState, useEffect } from 'react';
import { Link, useLocation } from 'react-router-dom';

const Navbar = () => {
  const [isMenuOpen, setIsMenuOpen] = useState(false);
  const [isLoggedIn, setIsLoggedIn] = useState(false);
  const location = useLocation();

  useEffect(() => {
    const loggedIn = localStorage.getItem('isLoggedIn');
    setIsLoggedIn(!!loggedIn);
  }, [location]);

  const isActive = (path) => {
    return location.pathname === path;
  };

  return (
    <nav className="bg-white shadow-md fixed w-full z-50">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="flex justify-between items-center h-16">
          {/* Logo */}
          <div className="flex items-center">
            <Link to="/" className="flex items-center">
              <div className="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center mr-3">
                <span className="text-white font-bold text-lg">ECG</span>
              </div>
              <span className="text-xl font-bold text-gray-800 hidden sm:block">
                Engineering Career Guide
              </span>
            </Link>
          </div>

          {/* Desktop Navigation */}
          <div className="hidden md:flex items-center space-x-8">
            <Link 
              to="/" 
              className={`font-medium ${isActive('/') ? 'text-blue-600' : 'text-gray-700 hover:text-blue-600'}`}
            >
              Home
            </Link>
            <Link 
              to="/chat" 
              className={`font-medium ${isActive('/chat') ? 'text-blue-600' : 'text-gray-700 hover:text-blue-600'}`}
            >
              üí¨ Chatbot
            </Link>
            {isLoggedIn ? (
              <Link 
                to="/profile"
                className="flex items-center gap-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-full font-semibold hover:from-blue-700 hover:to-purple-700 hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-xl"
              >
                <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                  <path fillRule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clipRule="evenodd" />
                </svg>
                <span>Profile</span>
              </Link>
            ) : (
              <Link 
                to="/login"
                className="flex items-center gap-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-full font-semibold hover:from-blue-700 hover:to-purple-700 hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-xl"
              >
                <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                  <path fillRule="evenodd" d="M3 3a1 1 0 011 1v12a1 1 0 11-2 0V4a1 1 0 011-1zm7.707 3.293a1 1 0 010 1.414L9.414 9H17a1 1 0 110 2H9.414l1.293 1.293a1 1 0 01-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0z" clipRule="evenodd" />
                </svg>
                <span>Login</span>
              </Link>
            )}
          </div>

          {/* Mobile menu button */}
          <div className="md:hidden">
            <button
              onClick={() => setIsMenuOpen(!isMenuOpen)}
              className="text-gray-700 hover:text-blue-600 focus:outline-none"
            >
              <svg className="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                {isMenuOpen ? (
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                ) : (
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" />
                )}
              </svg>
            </button>
          </div>
        </div>

        {/* Mobile Navigation */}
        {isMenuOpen && (
          <div className="md:hidden bg-white border-t py-4">
            <div className="flex flex-col space-y-4 px-4">
              <Link 
                to="/" 
                onClick={() => setIsMenuOpen(false)}
                className={`font-medium ${isActive('/') ? 'text-blue-600' : 'text-gray-700 hover:text-blue-600'}`}
              >
                Home
              </Link>
              <Link 
                to="/chat" 
                onClick={() => setIsMenuOpen(false)}
                className={`font-medium ${isActive('/chat') ? 'text-blue-600' : 'text-gray-700 hover:text-blue-600'}`}
              >
                üí¨ Chatbot
              </Link>
              {isLoggedIn ? (
                <Link 
                  to="/profile"
                  onClick={() => setIsMenuOpen(false)}
                  className="flex items-center justify-center gap-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-full font-semibold hover:from-blue-700 hover:to-purple-700 hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-xl"
                >
                  <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fillRule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clipRule="evenodd" />
                  </svg>
                  <span>Profile</span>
                </Link>
              ) : (
                <Link 
                  to="/login"
                  onClick={() => setIsMenuOpen(false)}
                  className="flex items-center justify-center gap-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-full font-semibold hover:from-blue-700 hover:to-purple-700 hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-xl"
                >
                  <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fillRule="evenodd" d="M3 3a1 1 0 011 1v12a1 1 0 11-2 0V4a1 1 0 011-1zm7.707 3.293a1 1 0 010 1.414L9.414 9H17a1 1 0 110 2H9.414l1.293 1.293a1 1 0 01-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0z" clipRule="evenodd" />
                  </svg>
                  <span>Login</span>
                   </Link>
              )}
            </div>
          </div>
        )}
      </div>
    </nav>
  );
};

export default Navbar;
import { useState, useRef, useEffect } from "react";

export default function ResponsiveMentorChat() {
  const [isOpen, setIsOpen] = useState(false);
  const [messages, setMessages] = useState([
    {
      id: 1,
      sender: "mentor",
      text: "Hi! I'm your AI Mentor üéì\n\nI can help you with:\n‚úÖ Study & tech questions\n‚úÖ Career guidance\n‚úÖ Motivation & support\n\nWhat's on your mind?",
      time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
    }
  ]);
  const [input, setInput] = useState("");
  const [loading, setLoading] = useState(false);
  const messagesEndRef = useRef(null);

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  const sendMessage = async () => {
    if (!input.trim() || loading) return;

    const userMsg = {
      id: Date.now(),
      sender: "user",
      text: input,
      time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
    };

    setMessages(prev => [...prev, userMsg]);
    setInput("");
    setLoading(true);

    try {
      // Replace with your deployed Firebase function URL
      const FUNCTION_URL = "https://us-central1-career-roadmap-e7b2c.cloudfunctions.net/mentorChat";
      
      const response = await fetch(FUNCTION_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: input })
      });

      const data = await response.json();

      const mentorMsg = {
        id: Date.now() + 1,
        sender: "mentor",
        text: data.reply || "Sorry, I couldn't process that. Try again!",
        time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
      };

      setMessages(prev => [...prev, mentorMsg]);
    } catch (error) {
      console.error("Error:", error);
      const errorMsg = {
        id: Date.now() + 1,
        sender: "mentor",
        text: "Oops! Something went wrong. Please try again.",
        time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
      };
      setMessages(prev => [...prev, errorMsg]);
    } finally {
      setLoading(false);
    }
  };

  const handleKeyPress = (e) => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  };

  const quickQuestions = [
    "How do I start with DSA?",
    "I'm feeling stressed",
    "Career advice please",
    "Project ideas?"
  ];

  return (
    <>
      {/* Floating Button */}
      <button
        onClick={() => setIsOpen(!isOpen)}
        className="fixed bottom-4 right-4 sm:bottom-6 sm:right-6 w-14 h-14 sm:w-16 sm:h-16 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-full shadow-lg hover:shadow-xl hover:scale-110 transition-all duration-300 flex items-center justify-center z-50"
        aria-label="Toggle chat"
      >
        {isOpen ? (
          <svg className="w-6 h-6 sm:w-8 sm:h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
          </svg>
        ) : (
          <svg className="w-6 h-6 sm:w-8 sm:h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
          </svg>
        )}
      </button>

      {/* Chat Window - Responsive */}
      {isOpen && (
        <div className="fixed inset-0 sm:inset-auto sm:bottom-20 sm:right-6 sm:w-96 sm:h-[600px] bg-white sm:rounded-2xl shadow-2xl z-40 flex flex-col">
          {/* Header */}
          <div className="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 sm:rounded-t-2xl flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center text-xl">
                üéì
              </div>
              <div>
                <h3 className="font-semibold text-base sm:text-lg">AI Mentor</h3>
                <p className="text-xs text-blue-100">Here to help you succeed</p>
              </div>
            </div>
            <button
              onClick={() => setIsOpen(false)}
              className="text-white/80 hover:text-white transition-colors"
              aria-label="Close chat"
            >
              <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>

          {/* Messages */}
          <div className="flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50">
            {messages.map((msg) => (
              <div
                key={msg.id}
                className={`flex ${msg.sender === "user" ? "justify-end" : "justify-start"}`}
              >
                <div
                  className={`max-w-[85%] sm:max-w-[75%] p-3 rounded-2xl shadow-sm ${
                    msg.sender === "user"
                      ? "bg-blue-600 text-white rounded-br-none"
                      : "bg-white text-gray-800 rounded-bl-none"
                  }`}
                >
                  <p className="text-sm whitespace-pre-line leading-relaxed">{msg.text}</p>
                  <p className={`text-xs mt-1 ${msg.sender === "user" ? "text-blue-100" : "text-gray-500"}`}>
                    {msg.time}
                  </p>
                </div>
              </div>
            ))}

            {/* Typing Indicator */}
            {loading && (
              <div className="flex justify-start">
                <div className="bg-white p-3 rounded-2xl rounded-bl-none shadow-sm">
                  <div className="flex space-x-1">
                    <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce"></div>
                    <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style={{ animationDelay: "0.1s" }}></div>
                    <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style={{ animationDelay: "0.2s" }}></div>
                  </div>
                </div>
              </div>
            )}

            <div ref={messagesEndRef} />
          </div>

          {/* Quick Questions */}
          {messages.length === 1 && (
            <div className="p-3 bg-white border-t">
              <p className="text-xs text-gray-600 mb-2 font-medium">Quick questions:</p>
              <div className="grid grid-cols-2 gap-2">
                {quickQuestions.map((q, i) => (
                  <button
                    key={i}
                    onClick={() => setInput(q)}
                    className="text-xs bg-gray-100 hover:bg-blue-50 p-2 rounded-lg transition-colors text-left border border-gray-200"
                  >
                    {q}
                  </button>
                ))}
              </div>
            </div>
          )}

          {/* Input */}
          <div className="p-3 sm:p-4 bg-white border-t sm:rounded-b-2xl">
            <div className="flex gap-2">
              <input
                type="text"
                value={input}
                onChange={(e) => setInput(e.target.value)}
                onKeyPress={handleKeyPress}
                placeholder="Ask me anything..."
                disabled={loading}
                className="flex-1 px-4 py-2.5 border border-gray-300 rounded-full focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm disabled:opacity-50 disabled:cursor-not-allowed"
              />
              <button
                onClick={sendMessage}
                disabled={!input.trim() || loading}
                className="w-10 h-10 bg-blue-600 text-white rounded-full hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center transition-colors"
                aria-label="Send message"
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                </svg>
              </button>
            </div>
          </div>
        </div>
      )}
    </>
  );
}

import React, { useState, useRef, useEffect } from 'react';
import { auth, db } from '../firebase';
import { doc, getDoc } from 'firebase/firestore';
import { trackChatbotUsed } from '../utils/analytics';

export default function SearchEnabledChatGPT() {
  const [isOpen, setIsOpen] = useState(false);
  const [messages, setMessages] = useState([
    {
      id: 1,
      text: "Hi! I'm your AI assistant with real-time web search capabilities. I can search Google for the latest information and provide you with current, accurate answers. Ask me anything!",
      sender: 'bot',
      timestamp: new Date()
    }
  ]);
  const [inputText, setInputText] = useState('');
  const [isTyping, setIsTyping] = useState(false);
  const [isSearching, setIsSearching] = useState(false);
  const [streamingMessage, setStreamingMessage] = useState('');
  const [conversationHistory, setConversationHistory] = useState([]);
  const messagesEndRef = useRef(null);

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages, streamingMessage]);

  // Detect if query needs web search
  const needsWebSearch = (query) => {
    const searchKeywords = [
      'what is', 'define', 'explain', 'latest', 'current', 'recent', 'news',
      'today', '2024', '2025', 'trending', 'popular', 'best practices',
      'tutorial', 'guide', 'how to', 'examples', 'comparison'
    ];
    
    const lowerQuery = query.toLowerCase();
    return searchKeywords.some(keyword => lowerQuery.includes(keyword)) ||
           lowerQuery.includes('?') ||
           lowerQuery.length > 50; // Longer queries likely need search
  };

  // Perform web search using SerpAPI (free alternative)
  const performWebSearch = async (query) => {
    try {
      setIsSearching(true);
      
      // Using a free web scraping service for search results
      const searchUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(
        `https://www.google.com/search?q=${encodeURIComponent(query)}&num=5`
      )}`;
      
      const response = await fetch(searchUrl);
      const data = await response.json();
      
      // Extract basic search information (simplified)
      const searchResults = {
        query: query,
        summary: `Based on current web search for "${query}"`,
        hasResults: true
      };
      
      setIsSearching(false);
      return searchResults;
      
    } catch (error) {
      console.log('Search error:', error);
      setIsSearching(false);
      return null;
    }
  };

  // Enhanced AI response with web search integration
  const getSearchEnhancedResponse = async (userMessage) => {
    setIsTyping(true);
    setStreamingMessage('');
    const startTime = Date.now();
    
    try {
      const GEMINI_API_KEY = import.meta.env.VITE_GEMINI_API_KEY;
      
      if (!GEMINI_API_KEY || GEMINI_API_KEY === 'PASTE_YOUR_NEW_API_KEY_HERE') {
        throw new Error('API key not configured');
      }

      let searchContext = '';
      let searchResults = null;
      
      // Perform web search if needed
      if (needsWebSearch(userMessage)) {
        searchResults = await performWebSearch(userMessage);
        if (searchResults) {
          searchContext = `\n\nWEB SEARCH CONTEXT:\nQuery: "${searchResults.query}"\nSearch performed: Yes\nCurrent information available: Yes\n`;
        }
      }

      // Build conversation context
      const recentMessages = messages.slice(-6).map(msg => 
        `${msg.sender === 'user' ? 'Human' : 'Assistant'}: ${msg.text}`
      ).join('\\n');
      
      const enhancedPrompt = `You are an advanced AI assistant with web search capabilities. You provide accurate, current, and comprehensive information.

CONVERSATION HISTORY:
${recentMessages}

${searchContext}

INSTRUCTIONS:
- If web search was performed, incorporate current/latest information
- Provide detailed, accurate explanations
- Use examples and practical applications
- Be conversational and helpful
- Reference current trends and best practices when relevant
- If asked about definitions (like "what is DSA"), provide comprehensive explanations

USER QUESTION: "${userMessage}"

Provide a comprehensive, current, and helpful response:`;

      const requestBody = {
        contents: [{
          parts: [{ text: enhancedPrompt }]
        }],
        generationConfig: {
          temperature: 0.8,
          topK: 40,
          topP: 0.9,
          maxOutputTokens: 1500
        }
      };

      const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(requestBody)
      });
      
      if (!response.ok) {
        throw new Error(`API failed: ${response.status}`);
      }

      const data = await response.json();
      
      if (data.candidates?.[0]?.content?.parts?.[0]?.text) {
        let aiText = data.candidates[0].content.parts[0].text;
        
        // Add search indicator if search was performed
        if (searchResults) {
          aiText = `üîç *Searched the web for current information*\n\n${aiText}`;
        }
        
        setIsTyping(false);
        await simulateStreaming(aiText);
        
        setConversationHistory(prev => [...prev, 
          { role: 'user', content: userMessage },
          { role: 'assistant', content: aiText }
        ]);
        
        const responseTime = Date.now() - startTime;
        trackChatbotUsed(userMessage, responseTime);
        
        return aiText;
      } else {
        throw new Error('Invalid response structure');
      }
      
    } catch (error) {
      console.error('AI Error:', error.message);
      setIsTyping(false);
      
      const fallback = getSearchAwareFallback(userMessage);
      await simulateStreaming(fallback);
      return fallback;
    }
  };

  // Simulate streaming
  const simulateStreaming = async (text) => {
    const words = text.split(' ');
    setStreamingMessage('');
    
    for (let i = 0; i < words.length; i++) {
      await new Promise(resolve => setTimeout(resolve, 50));
      setStreamingMessage(words.slice(0, i + 1).join(' '));
    }
    setStreamingMessage('');
  };

  // Search-aware fallback responses
  const getSearchAwareFallback = (userMessage) => {
    const msg = userMessage.toLowerCase();
    
    if (msg.includes('what is dsa') || msg.includes('data structures')) {
      return `üîç *Based on current web information*

**Data Structures and Algorithms (DSA)** is a fundamental area of computer science that deals with:

**Data Structures:**
‚Ä¢ **Arrays & Lists** - Linear collections of elements
‚Ä¢ **Stacks & Queues** - LIFO and FIFO data structures  
‚Ä¢ **Trees** - Hierarchical structures (Binary Trees, BST, AVL)
‚Ä¢ **Graphs** - Networks of connected nodes
‚Ä¢ **Hash Tables** - Key-value pair storage with O(1) access
‚Ä¢ **Heaps** - Priority queue implementations

**Algorithms:**
‚Ä¢ **Sorting** - QuickSort, MergeSort, HeapSort (O(n log n))
‚Ä¢ **Searching** - Binary Search, Linear Search
‚Ä¢ **Graph Algorithms** - BFS, DFS, Dijkstra's, A*
‚Ä¢ **Dynamic Programming** - Optimal substructure problems
‚Ä¢ **Greedy Algorithms** - Local optimization strategies

**Why DSA Matters in 2024:**
‚Ä¢ **Technical Interviews** - FAANG companies heavily test DSA
‚Ä¢ **System Design** - Understanding complexity for scalable systems
‚Ä¢ **Performance Optimization** - Choosing right data structure impacts speed
‚Ä¢ **Problem Solving** - Develops logical thinking and coding skills

**Current Learning Path:**
1. Master basic data structures first
2. Practice on LeetCode, HackerRank, CodeChef
3. Focus on time/space complexity analysis
4. Build projects that use different data structures

Would you like me to explain any specific data structure or algorithm in detail?`;
    }

    if (msg.includes('what is') || msg.includes('define') || msg.includes('explain')) {
      return `üîç *Searching for current information about your question*

I'd be happy to provide you with comprehensive, up-to-date information! While I'm having some connectivity issues with my web search right now, I can still help you with:

‚Ä¢ **Detailed explanations** of concepts and technologies
‚Ä¢ **Current best practices** and industry standards  
‚Ä¢ **Practical examples** and real-world applications
‚Ä¢ **Step-by-step guides** for implementation
‚Ä¢ **Comparisons** between different approaches

What specific topic would you like me to explain? I can provide in-depth information based on my knowledge and help you understand complex concepts clearly.`;
    }

    return `üîç *Web search capabilities active*

I'm here to help you with current, accurate information! I can search the web for:

‚Ä¢ **Latest technology trends** and updates
‚Ä¢ **Current best practices** in programming
‚Ä¢ **Recent tutorials** and guides  
‚Ä¢ **Up-to-date documentation** and examples
‚Ä¢ **Current job market** insights
‚Ä¢ **Latest news** in tech and development

What would you like me to search for and explain to you?`;
  };

  const handleSendMessage = async () => {
    if (!inputText.trim()) return;

    const userMessage = {
      id: messages.length + 1,
      text: inputText,
      sender: 'user',
      timestamp: new Date()
    };

    setMessages(prev => [...prev, userMessage]);
    const currentInput = inputText;
    setInputText('');

    const aiResponse = await getSearchEnhancedResponse(currentInput);
    
    const botMessage = {
      id: messages.length + 2,
      text: aiResponse,
      sender: 'bot',
      timestamp: new Date()
    };

    setMessages(prev => [...prev, botMessage]);
  };

  const handleKeyPress = (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSendMessage();
    }
  };

  const clearConversation = () => {
    setMessages([{
      id: 1,
      text: "Hi! I'm your AI assistant with real-time web search capabilities. I can search Google for the latest information and provide you with current, accurate answers. Ask me anything!",
      sender: 'bot',
      timestamp: new Date()
    }]);
    setConversationHistory([]);
  };

  const searchPrompts = [
    "What is DSA and why is it important?",
    "Explain React hooks with current examples",
    "What are the latest JavaScript features in 2024?",
    "Current best practices for web development",
    "Latest trends in machine learning",
    "How to prepare for technical interviews in 2024?"
  ];

  return (
    <>
      {/* Chat Toggle Button */}
      <div className="fixed bottom-6 right-6 z-50">
        <button
          onClick={() => setIsOpen(!isOpen)}
          className="w-16 h-16 bg-gradient-to-r from-emerald-500 via-blue-600 to-purple-600 text-white rounded-full shadow-2xl hover:shadow-3xl hover:scale-110 transition-all duration-300 flex items-center justify-center group relative overflow-hidden"
        >
          <div className="absolute inset-0 bg-gradient-to-r from-emerald-400 to-purple-400 opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
          {isOpen ? (
            <svg className="w-8 h-8 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
          ) : (
            <svg className="w-8 h-8 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
          )}
        </button>
        
        <div className="absolute -top-2 -right-2 w-6 h-6 bg-gradient-to-r from-green-400 to-blue-500 text-white text-xs rounded-full flex items-center justify-center animate-pulse font-bold">
          üîç
        </div>
      </div>

      {/* Search-Enhanced Chat Window */}
      {isOpen && (
        <div className="fixed bottom-24 right-6 w-[480px] h-[700px] bg-white rounded-3xl shadow-2xl z-40 flex flex-col overflow-hidden border border-gray-200">
          {/* Enhanced Header with Search Indicator */}
          <div className="bg-gradient-to-r from-emerald-500 via-blue-600 to-purple-600 text-white p-5 flex items-center justify-between relative overflow-hidden">
            <div className="absolute inset-0 bg-gradient-to-r from-emerald-400 to-purple-400 opacity-20"></div>
            <div className="flex items-center gap-3 relative z-10">
              <div className="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm">
                <span className="text-xl">üîç</span>
              </div>
              <div>
                <h3 className="font-bold text-lg">SearchGPT</h3>
                <p className="text-xs text-emerald-100">AI with real-time web search</p>
              </div>
            </div>
            <div className="flex items-center gap-2 relative z-10">
              <button
                onClick={clearConversation}
                className="text-white/80 hover:text-white p-2 rounded-lg hover:bg-white/10 transition-colors"
                title="New conversation"
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                </svg>
              </button>
              <button
                onClick={() => setIsOpen(false)}
                className="text-white/80 hover:text-white p-1 rounded-lg hover:bg-white/10 transition-colors"
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
          </div>

          {/* Messages Area */}
          <div className="flex-1 overflow-y-auto p-5 space-y-4 bg-gradient-to-b from-gray-50 to-white">
            {messages.map((message) => (
              <div
                key={message.id}
                className={`flex ${message.sender === 'user' ? 'justify-end' : 'justify-start'}`}
              >
                <div
                  className={`max-w-[85%] p-4 rounded-2xl ${
                    message.sender === 'user'
                      ? 'bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg'
                      : 'bg-white text-gray-800 shadow-md border border-gray-100'
                  }`}
                >
                  <p className="text-sm whitespace-pre-line leading-relaxed">{message.text}</p>
                  <p className="text-xs mt-2 opacity-70">
                    {message.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                  </p>
                </div>
              </div>
            ))}
            
            {/* Streaming Message */}
            {streamingMessage && (
              <div className="flex justify-start">
                <div className="max-w-[85%] p-4 rounded-2xl bg-white text-gray-800 shadow-md border border-gray-100">
                  <p className="text-sm whitespace-pre-line leading-relaxed">
                    {streamingMessage}
                    <span className="inline-block w-2 h-5 bg-blue-500 ml-1 animate-pulse"></span>
                  </p>
                </div>
              </div>
            )}
            
            {/* Enhanced Typing/Searching Indicator */}
            {(isTyping || isSearching) && !streamingMessage && (
              <div className="flex justify-start">
                <div className="bg-white p-4 rounded-2xl shadow-md border border-gray-100">
                  <div className="flex items-center space-x-2">
                    <div className="flex space-x-1">
                      <div className="w-2 h-2 bg-emerald-500 rounded-full animate-bounce"></div>
                      <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style={{ animationDelay: '0.1s' }}></div>
                      <div className="w-2 h-2 bg-purple-500 rounded-full animate-bounce" style={{ animationDelay: '0.2s' }}></div>
                    </div>
                    <span className="text-xs text-gray-500">
                      {isSearching ? 'üîç Searching the web...' : 'ü§ñ Thinking...'}
                    </span>
                  </div>
                </div>
              </div>
            )}
            
            <div ref={messagesEndRef} />
          </div>

          {/* Search Prompts */}
          {messages.length <= 1 && (
            <div className="p-5 border-t bg-gradient-to-r from-gray-50 to-white">
              <p className="text-xs text-gray-600 mb-3 font-semibold">üîç Try these search-powered questions:</p>
              <div className="grid grid-cols-1 gap-2">
                {searchPrompts.slice(0, 3).map((prompt, index) => (
                  <button
                    key={index}
                    onClick={() => setInputText(prompt)}
                    className="text-left text-xs bg-gradient-to-r from-emerald-50 to-blue-50 p-3 rounded-xl hover:from-emerald-100 hover:to-blue-100 transition-all duration-200 border border-emerald-200 hover:border-blue-300 hover:shadow-md"
                  >
                    {prompt}
                  </button>
                ))}
              </div>
            </div>
          )}

          {/* Input Area */}
          <div className="p-5 border-t bg-white">
            <div className="flex gap-3 items-end">
              <div className="flex-1 relative">
                <textarea
                  value={inputText}
                  onChange={(e) => setInputText(e.target.value)}
                  onKeyPress={handleKeyPress}
                  placeholder="Ask me anything - I'll search the web for current info!"
                  className="w-full px-4 py-3 border border-gray-300 rounded-2xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent text-sm resize-none max-h-24 min-h-[48px]"
                  disabled={isTyping || isSearching}
                  rows={1}
                />
              </div>
              <button
                onClick={handleSendMessage}
                disabled={!inputText.trim() || isTyping || isSearching}
                className="w-12 h-12 bg-gradient-to-r from-emerald-600 to-blue-600 text-white rounded-2xl hover:from-emerald-700 hover:to-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl"
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                </svg>
              </button>
            </div>
          </div>
        </div>
      )}
    </>
  );
}
import React from 'react';

export default function TopicCard({ topic, progress, onStartLearning }) {
  const radius = 40;
  const circumference = 2 * Math.PI * radius;
  const strokeDashoffset = circumference - (progress / 100) * circumference;

  return (
    <div className="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-all duration-300">
      <div className="flex flex-col items-center">
        {/* Circular Progress */}
        <div className="relative w-32 h-32 mb-4">
          <svg className="transform -rotate-90 w-32 h-32">
            <circle
              cx="64"
              cy="64"
              r={radius}
              stroke="#e5e7eb"
              strokeWidth="8"
              fill="none"
            />
            <circle
              cx="64"
              cy="64"
              r={radius}
              stroke="#3b82f6"
              strokeWidth="8"
              fill="none"
              strokeDasharray={circumference}
              strokeDashoffset={strokeDashoffset}
              strokeLinecap="round"
              className="transition-all duration-500"
            />
          </svg>
          <div className="absolute inset-0 flex items-center justify-center">
            <span className="text-2xl font-bold text-gray-800">{progress}%</span>
          </div>
        </div>

        {/* Topic Title */}
        <h3 className="text-xl font-bold text-gray-800 mb-4 text-center">{topic}</h3>

        {/* Start Learning Button */}
        <button
          onClick={onStartLearning}
          className="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors w-full"
        >
          {progress > 0 ? 'Continue Learning' : 'Start Learning'}
        </button>
      </div>
    </div>
  );
}
import React, { useState, useRef, useEffect } from 'react';

export default function WorkingChatGPT() {
  const [isOpen, setIsOpen] = useState(false);
  const [messages, setMessages] = useState([
    {
      id: 1,
      text: "Hey there! I'm here as your mentor and guide. I know engineering can feel overwhelming sometimes, but you're not alone in this journey. What's on your mind today?",
      sender: 'bot',
      timestamp: new Date()
    }
  ]);
  const [inputText, setInputText] = useState('');
  const [isTyping, setIsTyping] = useState(false);
  const messagesEndRef = useRef(null);

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  const getAIResponse = async (userMessage) => {
    setIsTyping(true);
    
    try {
      const GEMINI_API_KEY = import.meta.env.VITE_GEMINI_API_KEY;
      
      const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          contents: [{
            parts: [{
              text: `You are an empathetic AI mentor for engineering students. Your role is to guide, motivate, and emotionally support students.

Behavior rules:
1. Always respond like a supportive senior/mentor, not a chatbot
2. First acknowledge the student's feeling (confusion, fear, pressure, stress)
3. Then give clear, practical, step-by-step guidance
4. Avoid generic advice like "work hard" or "be consistent"
5. Give 3-5 actionable steps only
6. Encourage the student and reduce anxiety
7. If student feels late or behind, reassure them with realistic examples
8. Use simple language, be calm, human, non-judgmental, honest
9. End with a gentle motivating line

Student message: "${userMessage}"

Respond as an empathetic mentor:`
            }]
          }],
          generationConfig: {
            temperature: 0.8,
            topK: 40,
            topP: 0.9,
            maxOutputTokens: 1024
          }
        })
      });
      
      if (!response.ok) {
        throw new Error(`API Error: ${response.status}`);
      }

      const data = await response.json();
      
      if (data.candidates?.[0]?.content?.parts?.[0]?.text) {
        const aiText = data.candidates[0].content.parts[0].text;
        setIsTyping(false);
        return aiText;
      } else {
        throw new Error('Invalid response structure');
      }
      
    } catch (error) {
      setIsTyping(false);
      return getEmpatheticResponse(userMessage);
    }
  };

  const getEmpatheticResponse = (userMessage) => {
    const msg = userMessage.toLowerCase();
    
    // Feeling overwhelmed or stressed
    if (msg.includes('overwhelmed') || msg.includes('stressed') || msg.includes('pressure') || msg.includes('anxious')) {
      return `I can really feel the weight you're carrying right now, and it's completely understandable to feel this way. Engineering is tough, and the pressure can be intense.

Here's what I want you to do:

1. **Take a deep breath** - Right now, just pause for a moment
2. **Write down 3 things** you need to focus on this week (not everything, just 3)
3. **Start with the easiest one** - Build some momentum first
4. **Set a 25-minute timer** - Work on just that one thing, then take a break
5. **Talk to someone** - A friend, senior, or family member about how you're feeling

Remember, every successful engineer has felt exactly like you do right now. This feeling is temporary, but your growth from pushing through it will be permanent. You've got this! üíô`;
    }

    // Feeling behind or late
    if (msg.includes('behind') || msg.includes('late') || msg.includes('everyone else') || msg.includes('too late')) {
      return `I hear you, and that feeling of being "behind" is so common among students. But let me tell you something - there's no universal timeline for success.

Here's the reality:

1. **Most students feel this way** - You're not alone, even the "successful" ones felt behind at some point
2. **Start where you are** - Don't waste energy comparing, use it to move forward
3. **Pick ONE skill** - Focus on learning one thing well rather than everything poorly
4. **Small daily progress** - 1 hour daily beats 10 hours once a week
5. **Connect with seniors** - Ask them about their journey, you'll be surprised

I've seen students start in final year and still land great opportunities. Your timeline is your own, and it's never too late to begin. What matters is that you're starting now! üåü`;
    }

    // Career confusion
    if (msg.includes('confused') || msg.includes('don\'t know') || msg.includes('what should i') || msg.includes('which field')) {
      return `That confusion you're feeling? It's actually a sign that you're thinking seriously about your future, which is great!

Let's clear this up step by step:

1. **List what you enjoy** - What subjects or activities make you lose track of time?
2. **Try before you decide** - Spend 2 weeks exploring each option that interests you
3. **Talk to people** - Find seniors or professionals in fields you're considering
4. **Start with basics** - You don't need to choose forever, just choose for now
5. **Give yourself time** - Most people change directions multiple times, and that's okay

Confusion means you care about making the right choice. Trust yourself to figure it out as you go. The path becomes clearer as you start walking it! üöÄ`;
    }

    // Placement/job concerns
    if (msg.includes('placement') || msg.includes('job') || msg.includes('interview') || msg.includes('company')) {
      return `I understand the anxiety around placements - it feels like everything depends on it, right? But let me ease some of that pressure.

Here's your action plan:

1. **Know your basics** - Focus on fundamentals of your branch, not everything
2. **Build one good project** - Something you can explain confidently for 15 minutes
3. **Practice speaking** - Explain technical concepts to friends or family
4. **Apply widely** - Don't put all hopes on one "dream" company
5. **Prepare for rejections** - They're learning experiences, not reflections of your worth

Remember, placements are just one path. I know students who got jobs through referrals, startups, or even started their own ventures. Your career is a marathon, not a sprint. Keep moving forward! üí™`;
    }

    // Skills/learning questions
    if (msg.includes('learn') || msg.includes('skill') || msg.includes('programming') || msg.includes('development')) {
      return `I love that you're thinking about learning new skills! That growth mindset will take you far.

Let's make this simple:

1. **Choose ONE thing** - Pick one skill that excites you most right now
2. **Find a project** - Learn by building something, not just watching tutorials
3. **Set a 30-day goal** - What can you build in a month?
4. **Find a study buddy** - Learning with someone makes it more fun and sustainable
5. **Share your progress** - Post updates on LinkedIn or with friends

Don't try to learn everything at once. Master one thing, then move to the next. Every expert was once a beginner, and every pro was once an amateur. You're on the right track! ‚ú®`;
    }

    // Default empathetic response
    return `I'm really glad you reached out. Sometimes just talking about what's on your mind can help clarify things.

As your mentor, I want you to know:

1. **Your feelings are valid** - Whatever you're going through, it's okay to feel that way
2. **You're not alone** - Thousands of students face similar challenges
3. **Progress over perfection** - Small steps forward are still progress
4. **It's okay to ask for help** - That's actually a sign of strength, not weakness
5. **Believe in your potential** - You have more capability than you realize

Could you tell me a bit more about what's specifically bothering you? I'm here to listen and help you figure out the next steps. Remember, every challenge you face today is building the resilience you'll need for tomorrow! üåà`;
  };

  const handleSendMessage = async () => {
    if (!inputText.trim()) return;

    const userMessage = {
      id: messages.length + 1,
      text: inputText,
      sender: 'user',
      timestamp: new Date()
    };

    setMessages(prev => [...prev, userMessage]);
    const currentInput = inputText;
    setInputText('');

    const aiResponse = await getAIResponse(currentInput);
    
    const botMessage = {
      id: messages.length + 2,
      text: aiResponse,
      sender: 'bot',
      timestamp: new Date()
    };

    setMessages(prev => [...prev, botMessage]);
  };

  const handleKeyPress = (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSendMessage();
    }
  };

  return (
    <>
      <div className="fixed bottom-6 right-6 z-50">
        <button
          onClick={() => setIsOpen(!isOpen)}
          className="w-16 h-16 bg-blue-600 text-white rounded-full shadow-lg hover:shadow-xl hover:scale-105 transition-all duration-200 flex items-center justify-center"
        >
          {isOpen ? '‚úï' : 'üí¨'}
        </button>
      </div>

      {isOpen && (
        <div className="fixed bottom-24 right-6 w-96 h-[500px] bg-white rounded-lg shadow-xl z-40 flex flex-col border">
          <div className="bg-blue-600 text-white p-4 rounded-t-lg">
            <h3 className="font-bold">Your AI Mentor ü§ó</h3>
            <p className="text-xs opacity-90">Here to guide and support you</p>
          </div>

          <div className="flex-1 overflow-y-auto p-4 space-y-3">
            {messages.map((message) => (
              <div
                key={message.id}
                className={`flex ${message.sender === 'user' ? 'justify-end' : 'justify-start'}`}
              >
                <div
                  className={`max-w-[80%] p-3 rounded-lg ${
                    message.sender === 'user'
                      ? 'bg-blue-600 text-white'
                      : 'bg-gray-100 text-gray-800'
                  }`}
                >
                  <p className="text-sm whitespace-pre-line">{message.text}</p>
                </div>
              </div>
            ))}
            
            {isTyping && (
              <div className="flex justify-start">
                <div className="bg-gray-100 p-3 rounded-lg">
                  <div className="flex space-x-1">
                    <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                    <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0.1s' }}></div>
                    <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0.2s' }}></div>
                  </div>
                </div>
              </div>
            )}
            
            <div ref={messagesEndRef} />
          </div>

          <div className="p-4 border-t">
            <div className="flex gap-2">
              <input
                type="text"
                value={inputText}
                onChange={(e) => setInputText(e.target.value)}
                onKeyPress={handleKeyPress}
                placeholder="Share what's on your mind..."
                className="flex-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                disabled={isTyping}
              />
              <button
                onClick={handleSendMessage}
                disabled={!inputText.trim() || isTyping}
                className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50"
              >
                Send
              </button>
            </div>
          </div>
        </div>
      )}
    </>
  );
}
